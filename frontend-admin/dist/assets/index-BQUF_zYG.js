import{v as B,r as m,j as S,B as h,C as t,D as s,ak as i,E as k,M as u,J as T,aq as A,y,O as w,W as E,z as _}from"./vue-Oyw5Wt-7.js";import{a as V,m as j,b as I}from"./index-ByGFeRIJ.js";import{E as O}from"./elementPlus-BZK7s8Hm.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BHoJcF0t.js";const U={class:"page-container"},q={class:"toolbar-row"},F={class:"toolbar-left"},H={key:1,class:"muted"},J=B({__name:"index",setup(W){const r=m(!1),f=m([]),d=m({page:1,size:10,total:0}),c=async()=>{r.value=!0;try{const a=await V({pageNum:d.value.page,pageSize:d.value.size});f.value=a.data.records,d.value.total=a.data.total}finally{r.value=!1}},v=async a=>{var n,l;if(!(a!=null&&a.id))return;const e=await I(a.id);a.isRead=((n=e.data)==null?void 0:n.isRead)??1,a.readTime=((l=e.data)==null?void 0:l.readTime)??new Date().toISOString()},C=async a=>{a.isRead!==1&&await v(a)},R=async()=>{const a=await j();O.success(`已读 ${a.data||0} 条`),await c()},z=a=>{if(!a)return"";const e=new Date(a);if(Number.isNaN(e.getTime()))return a;const n=l=>l<10?`0${l}`:`${l}`;return`${e.getFullYear()}-${n(e.getMonth()+1)}-${n(e.getDate())} ${n(e.getHours())}:${n(e.getMinutes())}:${n(e.getSeconds())}`};return S(c),(a,e)=>{const n=i("Check"),l=i("el-icon"),g=i("el-button"),D=i("Refresh"),b=i("el-card"),p=i("el-table-column"),$=i("el-tag"),x=i("el-table"),M=i("el-pagination"),N=A("loading");return _(),h("div",U,[t(b,{shadow:"never",class:"toolbar"},{default:s(()=>[k("div",q,[k("div",F,[t(g,{type:"primary",onClick:R,disabled:r.value},{default:s(()=>[t(l,null,{default:s(()=>[t(n)]),_:1}),e[2]||(e[2]=u(" 一键已读 ",-1))]),_:1},8,["disabled"]),t(g,{onClick:c,disabled:r.value},{default:s(()=>[t(l,null,{default:s(()=>[t(D)]),_:1}),e[3]||(e[3]=u(" 刷新 ",-1))]),_:1},8,["disabled"])])])]),_:1}),t(b,{shadow:"never"},{default:s(()=>[T((_(),y(x,{data:f.value,stripe:"",border:"",onRowClick:C,"row-class-name":"message-row"},{default:s(()=>[t(p,{prop:"createdAt",label:"时间",width:"180"},{default:s(({row:o})=>[u(w(z(o.createdAt)),1)]),_:1}),t(p,{prop:"title",label:"标题","min-width":"180"}),t(p,{prop:"content",label:"内容","min-width":"320","show-overflow-tooltip":""}),t(p,{prop:"isRead",label:"状态",width:"100"},{default:s(({row:o})=>[t($,{type:o.isRead===1?"info":"warning"},{default:s(()=>[u(w(o.isRead===1?"已读":"未读"),1)]),_:2},1032,["type"])]),_:1}),t(p,{label:"操作",width:"120",fixed:"right"},{default:s(({row:o})=>[o.isRead!==1?(_(),y(g,{key:0,type:"primary",link:"",onClick:E(Y=>v(o),["stop"])},{default:s(()=>[...e[4]||(e[4]=[u(" 标记已读 ",-1)])]),_:1},8,["onClick"])):(_(),h("span",H,"—"))]),_:1})]),_:1},8,["data"])),[[N,r.value]]),t(M,{class:"pagination","current-page":d.value.page,"onUpdate:currentPage":e[0]||(e[0]=o=>d.value.page=o),"page-size":d.value.size,"onUpdate:pageSize":e[1]||(e[1]=o=>d.value.size=o),"page-sizes":[10,20,50,100],total:d.value.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:c,onCurrentChange:c},null,8,["current-page","page-size","total"])]),_:1})])}}}),Z=P(J,[["__scopeId","data-v-5c32b48b"]]);export{Z as default};
