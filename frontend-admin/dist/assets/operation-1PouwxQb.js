import{s as H}from"./index-BHoJcF0t.js";import{v as K,r as b,l as Y,j as G,B as Q,C as e,D as t,ak as o,M as s,J as W,aq as X,y as $,O as d,K as Z,E as ee,z as w}from"./vue-Oyw5Wt-7.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./elementPlus-BZK7s8Hm.js";const ae={class:"page-container"},le=K({__name:"operation",setup(oe){const N=r=>({staff:"员工管理",room:"房间管理",hotel:"门店管理",order:"订单管理",pet:"宠物管理","care-log":"护理日志"})[r]||r,R=r=>({add:"新增",update:"修改",delete:"删除",login:"登录",logout:"登出"})[r]||r,h=b(!1),M=b([]),y=b(!1),p=b({}),n=Y({operatorName:"",module:"",status:null,dateRange:null}),i=Y({page:1,size:10,total:0}),k=r=>{if(!r)return"";const a=new Date(r),_=a.getFullYear(),f=String(a.getMonth()+1).padStart(2,"0"),u=String(a.getDate()).padStart(2,"0"),v=String(a.getHours()).padStart(2,"0"),V=String(a.getMinutes()).padStart(2,"0"),D=String(a.getSeconds()).padStart(2,"0");return`${_}-${f}-${u} ${v}:${V}:${D}`},I=r=>{if(!r)return"";try{return JSON.stringify(JSON.parse(r),null,2)}catch{return r}},g=async()=>{var r,a;h.value=!0;try{const _=await H.get("/log/operation/page",{params:{page:i.page,size:i.size,operatorName:n.operatorName||void 0,module:n.module||void 0,status:n.status??void 0,startDate:((r=n.dateRange)==null?void 0:r[0])||void 0,endDate:((a=n.dateRange)==null?void 0:a[1])||void 0}});M.value=_.data.records,i.total=_.data.total}catch(_){console.error("获取操作日志失败:",_)}finally{h.value=!1}},x=()=>{i.page=1,g()},T=()=>{n.operatorName="",n.module="",n.status=null,n.dateRange=null,x()},B=r=>{p.value=r,y.value=!0};return G(()=>{g()}),(r,a)=>{const _=o("el-input"),f=o("el-form-item"),u=o("el-option"),v=o("el-select"),V=o("el-date-picker"),D=o("Search"),z=o("el-icon"),S=o("el-button"),J=o("Refresh"),O=o("el-form"),C=o("el-card"),c=o("el-table-column"),U=o("el-tag"),P=o("el-table"),A=o("el-pagination"),m=o("el-descriptions-item"),j=o("el-scrollbar"),E=o("el-text"),F=o("el-descriptions"),L=o("el-dialog"),q=X("loading");return w(),Q("div",ae,[e(C,{shadow:"never",class:"search-form"},{default:t(()=>[e(O,{inline:!0,model:n},{default:t(()=>[e(f,{label:"操作人"},{default:t(()=>[e(_,{modelValue:n.operatorName,"onUpdate:modelValue":a[0]||(a[0]=l=>n.operatorName=l),placeholder:"请输入操作人",clearable:""},null,8,["modelValue"])]),_:1}),e(f,{label:"操作模块"},{default:t(()=>[e(v,{modelValue:n.module,"onUpdate:modelValue":a[1]||(a[1]=l=>n.module=l),placeholder:"全部模块",clearable:""},{default:t(()=>[e(u,{label:"员工管理",value:"staff"}),e(u,{label:"房间管理",value:"room"}),e(u,{label:"门店管理",value:"hotel"}),e(u,{label:"订单管理",value:"order"}),e(u,{label:"宠物管理",value:"pet"}),e(u,{label:"护理日志",value:"care-log"})]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"状态"},{default:t(()=>[e(v,{modelValue:n.status,"onUpdate:modelValue":a[2]||(a[2]=l=>n.status=l),placeholder:"全部状态",clearable:""},{default:t(()=>[e(u,{label:"成功",value:0}),e(u,{label:"失败",value:1})]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"日期范围"},{default:t(()=>[e(V,{modelValue:n.dateRange,"onUpdate:modelValue":a[3]||(a[3]=l=>n.dateRange=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(f,null,{default:t(()=>[e(S,{type:"primary",onClick:x},{default:t(()=>[e(z,null,{default:t(()=>[e(D)]),_:1}),a[7]||(a[7]=s("搜索 ",-1))]),_:1}),e(S,{onClick:T},{default:t(()=>[e(z,null,{default:t(()=>[e(J)]),_:1}),a[8]||(a[8]=s("重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(C,{shadow:"never"},{default:t(()=>[W((w(),$(P,{data:M.value,stripe:"",border:""},{default:t(()=>[e(c,{prop:"id",label:"ID",width:"80"}),e(c,{prop:"operatorName",label:"操作人",width:"120"}),e(c,{prop:"operationModule",label:"模块",width:"120"},{default:t(({row:l})=>[s(d(N(l.operationModule)),1)]),_:1}),e(c,{prop:"operationType",label:"操作类型",width:"100"},{default:t(({row:l})=>[s(d(R(l.operationType)),1)]),_:1}),e(c,{prop:"operationUrl",label:"请求URL","min-width":"200","show-overflow-tooltip":""}),e(c,{prop:"operationIp",label:"IP地址",width:"140"}),e(c,{prop:"operationResult",label:"状态",width:"80"},{default:t(({row:l})=>[e(U,{type:l.operationResult===0?"success":"danger"},{default:t(()=>[s(d(l.operationResult===0?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),e(c,{prop:"createdAt",label:"操作时间",width:"180"},{default:t(({row:l})=>[s(d(k(l.createdAt)),1)]),_:1}),e(c,{label:"操作",width:"80",fixed:"right"},{default:t(({row:l})=>[e(S,{type:"primary",link:"",onClick:ne=>B(l)},{default:t(()=>[...a[9]||(a[9]=[s("详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[q,h.value]]),e(A,{class:"pagination","current-page":i.page,"onUpdate:currentPage":a[4]||(a[4]=l=>i.page=l),"page-size":i.size,"onUpdate:pageSize":a[5]||(a[5]=l=>i.size=l),"page-sizes":[10,20,50,100],total:i.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:g,onCurrentChange:g},null,8,["current-page","page-size","total"])]),_:1}),e(L,{modelValue:y.value,"onUpdate:modelValue":a[6]||(a[6]=l=>y.value=l),title:"操作日志详情",width:"700px"},{default:t(()=>[e(F,{column:2,border:""},{default:t(()=>[e(m,{label:"操作人"},{default:t(()=>[s(d(p.value.operatorName),1)]),_:1}),e(m,{label:"操作时间"},{default:t(()=>[s(d(k(p.value.createdAt)),1)]),_:1}),e(m,{label:"模块"},{default:t(()=>[s(d(N(p.value.operationModule)),1)]),_:1}),e(m,{label:"操作类型"},{default:t(()=>[s(d(R(p.value.operationType)),1)]),_:1}),e(m,{label:"IP地址"},{default:t(()=>[s(d(p.value.operationIp),1)]),_:1}),e(m,{label:"状态"},{default:t(()=>[e(U,{type:p.value.operationResult===0?"success":"danger"},{default:t(()=>[s(d(p.value.operationResult===0?"成功":"失败"),1)]),_:1},8,["type"])]),_:1}),e(m,{label:"请求URL",span:2},{default:t(()=>[s(d(p.value.operationUrl),1)]),_:1}),e(m,{label:"请求参数",span:2},{default:t(()=>[e(j,{"max-height":"150px"},{default:t(()=>[ee("pre",null,d(I(p.value.operationParam)),1)]),_:1})]),_:1}),p.value.failMsg?(w(),$(m,{key:0,label:"失败原因",span:2},{default:t(()=>[e(E,{type:"danger"},{default:t(()=>[s(d(p.value.failMsg),1)]),_:1})]),_:1})):Z("",!0)]),_:1})]),_:1},8,["modelValue"])])}}}),ue=te(le,[["__scopeId","data-v-3d105059"]]);export{ue as default};
