import{u as ke,s as V}from"./index-BHoJcF0t.js";import{E as y,b as Ie}from"./elementPlus-BZK7s8Hm.js";import{v as Pe,c as M,r as b,l as O,j as Ce,B as C,C as e,D as a,ak as s,y as x,K as T,P as J,a4 as j,M as p,E as B,J as Ue,aq as Se,O as U,z as c}from"./vue-Oyw5Wt-7.js";import{_ as ze}from"./_plugin-vue_export-helper-DlAUqK2U.js";const De={class:"page-container"},Be={class:"table-toolbar"},$e={key:0,class:"flex items-center gap-2"},Le=["onClick"],Re={key:1,style:{color:"#999"}},qe={style:{"word-break":"break-all","font-size":"12px",color:"#666"}},Ee=Pe({__name:"index",setup(Fe){const $=ke(),N=M(()=>$.roleType===9),L=b(!1),R=b(!1),A=b([]),k=b(!1),S=b(),q=b([]),z=b(!1),E=b([]),i=O({hotelId:null,roomNo:"",typeName:"",status:null}),g=O({page:1,size:10,total:0}),n=O({id:null,hotelId:null,roomNo:"",typeName:"",pricePerNight:0,maxPetNum:1,description:"",features:[],images:[]}),I=b([]),te=M(()=>n.id?"编辑房间":"新增房间"),ae=M(()=>({hotelId:N.value?[{required:!0,message:"请选择所属酒店",trigger:"change"}]:[],roomNo:[{required:!0,message:"请输入房间号",trigger:"blur"}],typeName:[{required:!0,message:"请选择房间类型",trigger:"change"}],pricePerNight:[{required:!0,message:"请输入日租金",trigger:"blur"}],maxPetNum:[{required:!0,message:"请输入容量",trigger:"blur"}]})),H=o=>{if(!o)return[];try{return JSON.parse(o)}catch{return[]}},P=o=>{if(!o)return[];try{return JSON.parse(o)}catch{return[]}},oe=o=>({0:"空闲",1:"已预订",2:"入住中",3:"待清洁",4:"维修中"})[o]||"未知",re=o=>({0:"success",1:"primary",2:"warning",3:"info",4:"danger"})[o]||"",h=async()=>{L.value=!0;try{const o=N.value?i.hotelId:$.hotelId,l=await V.get("/room/page",{params:{pageNum:g.page,pageSize:g.size,hotelId:o||void 0,roomNo:i.roomNo||void 0,typeName:i.typeName||void 0,status:i.status??void 0}});A.value=l.data.records,g.total=l.data.total}catch(o){console.error("获取房间列表失败:",o)}finally{L.value=!1}},K=()=>{g.page=1,h()},ne=()=>{i.hotelId=null,i.roomNo="",i.typeName="",i.status=null,K()},se=()=>{ve(),k.value=!0},ue=o=>{const l=P(o.images);Object.assign(n,{id:o.id,hotelId:o.hotelId,roomNo:o.roomNo,typeName:o.typeName,pricePerNight:o.pricePerNight,maxPetNum:o.maxPetNum,description:o.description,features:H(o.features),images:l}),I.value=l.map((r,d)=>({name:`image-${d}`,url:r,uid:Date.now()+d})),k.value=!0},ie=o=>{const l=o.type.startsWith("image/"),r=o.size/1024/1024<10;return l?r?!0:(y.error("图片大小不能超过10MB"),!1):(y.error("只能上传图片文件"),!1)},de=async o=>{const{file:l,onSuccess:r,onError:d}=o;try{const u=new FormData;u.append("file",l);const w=await V.post("/upload/single",u,{headers:{"Content-Type":"multipart/form-data"}}),D={url:w.data.url,fileName:w.data.fileName};r(D);const v=I.value.find(f=>f.uid===l.uid);v&&(v.url=w.data.url,v.response=D),y.success("图片上传成功")}catch(u){d(u),y.error("图片上传失败")}},pe=o=>{var d;const l=((d=o.response)==null?void 0:d.url)||o.url,r=n.images.indexOf(l);r>-1&&n.images.splice(r,1)},me=o=>{const l=P(o.images);E.value=l.map(r=>({url:r})),z.value=!0},ce=async(o,l)=>{try{await V.put(`/room/${o.id}/status/${l}`),y.success("状态更新成功"),h()}catch(r){console.error("更新状态失败:",r)}},fe=async o=>{try{await Ie.confirm("确定要删除该房间吗？","提示",{type:"warning"}),await V.delete(`/room/${o.id}`),y.success("删除成功"),h()}catch(l){l!=="cancel"&&console.error("删除失败:",l)}},ge=async()=>{if(S.value)try{await S.value.validate(),R.value=!0;const o=I.value.map(r=>{var d;return((d=r.response)==null?void 0:d.url)||r.url}).filter(Boolean),l={...n,hotelId:N.value?n.hotelId:$.hotelId,features:JSON.stringify(n.features),images:JSON.stringify(o)};n.id?(await V.put("/room",l),y.success("更新成功")):(await V.post("/room",l),y.success("创建成功")),k.value=!1,h()}catch(o){console.error("提交失败:",o)}finally{R.value=!1}},ve=()=>{var o;n.id=null,n.hotelId=null,n.roomNo="",n.typeName="",n.pricePerNight=0,n.maxPetNum=1,n.description="",n.features=[],n.images=[],I.value=[],(o=S.value)==null||o.clearValidate()},_e=async()=>{if(N.value)try{const o=await V.get("/hotel/list");q.value=o.data||[]}catch(o){console.error("获取酒店列表失败:",o)}};return Ce(()=>{_e(),h()}),(o,l)=>{const r=s("el-option"),d=s("el-select"),u=s("el-form-item"),w=s("el-input"),D=s("Search"),v=s("el-icon"),f=s("el-button"),be=s("Refresh"),W=s("el-form"),G=s("el-card"),Q=s("Plus"),m=s("el-table-column"),X=s("el-image"),Y=s("el-tag"),ye=s("ArrowDown"),F=s("el-dropdown-item"),Ne=s("el-dropdown-menu"),he=s("el-dropdown"),Z=s("el-table"),we=s("el-pagination"),ee=s("el-input-number"),Ve=s("el-upload"),le=s("el-dialog"),xe=Se("loading");return c(),C("div",De,[e(G,{shadow:"never",class:"search-form"},{default:a(()=>[e(W,{inline:!0,model:i},{default:a(()=>[N.value?(c(),x(u,{key:0,label:"所属酒店"},{default:a(()=>[e(d,{modelValue:i.hotelId,"onUpdate:modelValue":l[0]||(l[0]=t=>i.hotelId=t),placeholder:"全部酒店",clearable:"",style:{width:"180px"}},{default:a(()=>[(c(!0),C(J,null,j(q.value,t=>(c(),x(r,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0),e(u,{label:"房间号"},{default:a(()=>[e(w,{modelValue:i.roomNo,"onUpdate:modelValue":l[1]||(l[1]=t=>i.roomNo=t),placeholder:"请输入房间号",clearable:""},null,8,["modelValue"])]),_:1}),e(u,{label:"房间类型"},{default:a(()=>[e(d,{modelValue:i.typeName,"onUpdate:modelValue":l[2]||(l[2]=t=>i.typeName=t),placeholder:"全部类型",clearable:""},{default:a(()=>[e(r,{label:"猫咪标间",value:"cat_standard"}),e(r,{label:"猫咪豪华间",value:"cat_deluxe"}),e(r,{label:"狗狗标间",value:"dog_standard"}),e(r,{label:"狗狗豪华间",value:"dog_deluxe"}),e(r,{label:"VIP套间",value:"vip_suite"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"状态"},{default:a(()=>[e(d,{modelValue:i.status,"onUpdate:modelValue":l[3]||(l[3]=t=>i.status=t),placeholder:"全部状态",clearable:""},{default:a(()=>[e(r,{label:"空闲",value:0}),e(r,{label:"已预订",value:1}),e(r,{label:"入住中",value:2}),e(r,{label:"待清洁",value:3}),e(r,{label:"维修中",value:4})]),_:1},8,["modelValue"])]),_:1}),e(u,null,{default:a(()=>[e(f,{type:"primary",onClick:K},{default:a(()=>[e(v,null,{default:a(()=>[e(D)]),_:1}),l[18]||(l[18]=p("搜索 ",-1))]),_:1}),e(f,{onClick:ne},{default:a(()=>[e(v,null,{default:a(()=>[e(be)]),_:1}),l[19]||(l[19]=p("重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(G,{shadow:"never"},{default:a(()=>[B("div",Be,[e(f,{type:"primary",onClick:se},{default:a(()=>[e(v,null,{default:a(()=>[e(Q)]),_:1}),l[20]||(l[20]=p("新增房间 ",-1))]),_:1})]),Ue((c(),x(Z,{data:A.value,stripe:"",border:""},{default:a(()=>[N.value?(c(),x(m,{key:0,prop:"hotelName",label:"所属酒店",width:"150"})):T("",!0),e(m,{prop:"roomNo",label:"房间号",width:"120"}),e(m,{prop:"typeNameDisplay",label:"房间类型",width:"140"}),e(m,{label:"图片",width:"150"},{default:a(({row:t})=>[P(t.images).length>0?(c(),C("div",$e,[e(X,{src:P(t.images)[0],"preview-src-list":P(t.images),"hide-on-click-modal":!0,"preview-teleported":!0,fit:"cover",style:{width:"40px",height:"40px","border-radius":"4px",cursor:"pointer"}},null,8,["src","preview-src-list"]),B("span",{style:{color:"#409eff",cursor:"pointer"},onClick:_=>me(t)}," 共"+U(P(t.images).length)+"张 ",9,Le)])):(c(),C("span",Re,"无"))]),_:1}),e(m,{prop:"pricePerNight",label:"日租金(元)",width:"120"},{default:a(({row:t})=>[p(" ¥"+U(t.pricePerNight),1)]),_:1}),e(m,{prop:"maxPetNum",label:"容量(只)",width:"100"}),e(m,{prop:"status",label:"状态",width:"100"},{default:a(({row:t})=>[e(Y,{type:re(t.status)},{default:a(()=>[p(U(oe(t.status)),1)]),_:2},1032,["type"])]),_:1}),e(m,{prop:"description",label:"描述","min-width":"150","show-overflow-tooltip":""}),e(m,{prop:"features",label:"房间设施","min-width":"200"},{default:a(({row:t})=>[(c(!0),C(J,null,j(H(t.features),_=>(c(),x(Y,{key:_,size:"small",style:{"margin-right":"4px","margin-bottom":"2px"}},{default:a(()=>[p(U(_),1)]),_:2},1024))),128))]),_:1}),e(m,{label:"操作",width:"200",fixed:"right"},{default:a(({row:t})=>[e(f,{type:"primary",link:"",onClick:_=>ue(t)},{default:a(()=>[...l[21]||(l[21]=[p("编辑",-1)])]),_:1},8,["onClick"]),e(he,{onCommand:_=>ce(t,_),style:{"margin-left":"10px"}},{dropdown:a(()=>[e(Ne,null,{default:a(()=>[e(F,{command:0},{default:a(()=>[...l[23]||(l[23]=[p("空闲",-1)])]),_:1}),e(F,{command:3},{default:a(()=>[...l[24]||(l[24]=[p("待清洁",-1)])]),_:1}),e(F,{command:4},{default:a(()=>[...l[25]||(l[25]=[p("维修中",-1)])]),_:1})]),_:1})]),default:a(()=>[e(f,{type:"warning",link:""},{default:a(()=>[l[22]||(l[22]=p(" 状态",-1)),e(v,{class:"el-icon--right"},{default:a(()=>[e(ye)]),_:1})]),_:1})]),_:1},8,["onCommand"]),e(f,{type:"danger",link:"",onClick:_=>fe(t)},{default:a(()=>[...l[26]||(l[26]=[p("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[xe,L.value]]),e(we,{class:"pagination","current-page":g.page,"onUpdate:currentPage":l[4]||(l[4]=t=>g.page=t),"page-size":g.size,"onUpdate:pageSize":l[5]||(l[5]=t=>g.size=t),"page-sizes":[10,20,50,100],total:g.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:h,onCurrentChange:h},null,8,["current-page","page-size","total"])]),_:1}),e(le,{modelValue:k.value,"onUpdate:modelValue":l[15]||(l[15]=t=>k.value=t),title:te.value,width:"500px"},{footer:a(()=>[e(f,{onClick:l[14]||(l[14]=t=>k.value=!1)},{default:a(()=>[...l[28]||(l[28]=[p("取消",-1)])]),_:1}),e(f,{type:"primary",onClick:ge,loading:R.value},{default:a(()=>[...l[29]||(l[29]=[p("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[e(W,{ref_key:"formRef",ref:S,model:n,rules:ae.value,"label-width":"100px"},{default:a(()=>[N.value?(c(),x(u,{key:0,label:"所属酒店",prop:"hotelId"},{default:a(()=>[e(d,{modelValue:n.hotelId,"onUpdate:modelValue":l[6]||(l[6]=t=>n.hotelId=t),placeholder:"请选择酒店",style:{width:"100%"}},{default:a(()=>[(c(!0),C(J,null,j(q.value,t=>(c(),x(r,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0),e(u,{label:"房间号",prop:"roomNo"},{default:a(()=>[e(w,{modelValue:n.roomNo,"onUpdate:modelValue":l[7]||(l[7]=t=>n.roomNo=t),placeholder:"请输入房间号"},null,8,["modelValue"])]),_:1}),e(u,{label:"房间类型",prop:"typeName"},{default:a(()=>[e(d,{modelValue:n.typeName,"onUpdate:modelValue":l[8]||(l[8]=t=>n.typeName=t),placeholder:"请选择房间类型",style:{width:"100%"}},{default:a(()=>[e(r,{label:"猫咪标间",value:"cat_standard"}),e(r,{label:"猫咪豪华间",value:"cat_deluxe"}),e(r,{label:"狗狗标间",value:"dog_standard"}),e(r,{label:"狗狗豪华间",value:"dog_deluxe"}),e(r,{label:"VIP套间",value:"vip_suite"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"日租金",prop:"pricePerNight"},{default:a(()=>[e(ee,{modelValue:n.pricePerNight,"onUpdate:modelValue":l[9]||(l[9]=t=>n.pricePerNight=t),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(u,{label:"容量",prop:"maxPetNum"},{default:a(()=>[e(ee,{modelValue:n.maxPetNum,"onUpdate:modelValue":l[10]||(l[10]=t=>n.maxPetNum=t),min:1,max:10,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(u,{label:"描述",prop:"description"},{default:a(()=>[e(w,{modelValue:n.description,"onUpdate:modelValue":l[11]||(l[11]=t=>n.description=t),type:"textarea",placeholder:"请输入房间描述",rows:3},null,8,["modelValue"])]),_:1}),e(u,{label:"房间设施",prop:"features"},{default:a(()=>[e(d,{modelValue:n.features,"onUpdate:modelValue":l[12]||(l[12]=t=>n.features=t),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择或输入房间设施",style:{width:"100%"}},{default:a(()=>[e(r,{label:"监控",value:"监控"}),e(r,{label:"空调",value:"空调"}),e(r,{label:"猫爬架",value:"猫爬架"}),e(r,{label:"独立卫生间",value:"独立卫生间"}),e(r,{label:"自动喂食器",value:"自动喂食器"}),e(r,{label:"智能温控",value:"智能温控"}),e(r,{label:"紫外线消毒",value:"紫外线消毒"}),e(r,{label:"新风系统",value:"新风系统"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"房间图片"},{default:a(()=>[e(Ve,{"file-list":I.value,"onUpdate:fileList":l[13]||(l[13]=t=>I.value=t),action:"#","http-request":de,"on-remove":pe,"before-upload":ie,"list-type":"picture-card",limit:10,accept:"image/*"},{default:a(()=>[e(v,null,{default:a(()=>[e(Q)]),_:1})]),_:1},8,["file-list"]),l[27]||(l[27]=B("div",{style:{color:"#999","font-size":"12px","margin-top":"8px"}}," 最多上传10张图片，支持jpg/png格式，单张不超过10MB ",-1))]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),e(le,{modelValue:z.value,"onUpdate:modelValue":l[17]||(l[17]=t=>z.value=t),title:"房间图片",width:"700px"},{footer:a(()=>[e(f,{onClick:l[16]||(l[16]=t=>z.value=!1)},{default:a(()=>[...l[30]||(l[30]=[p("关闭",-1)])]),_:1})]),default:a(()=>[e(Z,{data:E.value,border:""},{default:a(()=>[e(m,{type:"index",label:"序号",width:"60"}),e(m,{label:"预览图",width:"120"},{default:a(({row:t})=>[e(X,{src:t.url,"preview-src-list":E.value.map(_=>_.url),"hide-on-click-modal":!0,"preview-teleported":!0,"z-index":9999,fit:"cover",style:{width:"80px",height:"80px","border-radius":"4px",cursor:"pointer"}},null,8,["src","preview-src-list"])]),_:1}),e(m,{label:"URL",prop:"url"},{default:a(({row:t})=>[B("div",qe,U(t.url),1)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}}}),je=ze(Ee,[["__scopeId","data-v-837d182a"]]);export{je as default};
