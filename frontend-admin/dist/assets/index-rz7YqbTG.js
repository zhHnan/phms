import{s as Ce,r as Ne,p as xe,E as C,b as le}from"./elementPlus-BZK7s8Hm.js";import{s as U}from"./index-BHoJcF0t.js";import{v as Ve,r as h,l as K,j as Ie,B as d,C as t,D as a,ak as p,M as n,u as W,J as Se,aq as De,y as N,O as o,E as m,K as y,P as L,a4 as B,z as r}from"./vue-Oyw5Wt-7.js";import{_ as $e}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ze={class:"page-container"},Ue={key:0},Te={class:"text-warning"},Me={key:1,class:"text-gray-500"},Pe={key:0},Ae={key:1,class:"text-gray-500"},Fe={key:0,class:"flex items-center gap-3"},Le={class:"text-warning"},Be={key:0,style:{"margin-left":"20px"},class:"text-gray-500"},Ee={key:1,class:"text-gray-500"},Oe={key:0},je={key:1,class:"text-gray-500"},qe={key:0,class:"mt-5"},Re={class:"step-header"},He={key:1,class:"mt-5"},Je={class:"selected-pets"},Ke={key:0,class:"text-gray-400"},We={key:2,class:"mt-5"},Ye={class:"result-row"},Ge={class:"value"},Qe={class:"result-row"},Xe={class:"value"},Ze={key:0,class:"result-row"},et={class:"value image-preview"},tt={class:"dialog-footer"},at=Ve({__name:"index",setup(lt){const E=h(!1),Y=h([]),O=h(!1),u=h({}),T=h(!1),_=h(0),j=h(!1),P=h([]),k=h([]),G=h(0),x=h([]),A=h([]),i=K({petIds:[],petNames:"",careType:6,content:"",notes:"",images:""}),f=K({orderNo:"",petName:"",status:null}),V=K({page:1,size:10,total:0}),Q=s=>({0:"待支付",1:"待入住",2:"已入住",3:"已完成",4:"已取消"})[s]||"未知",X=s=>({0:"info",1:"primary",2:"warning",3:"success",4:"danger"})[s]||"",q=s=>{if(!s)return"";const e=new Date(s),I=e.getFullYear(),w=String(e.getMonth()+1).padStart(2,"0"),b=String(e.getDate()).padStart(2,"0"),$=String(e.getHours()).padStart(2,"0"),z=String(e.getMinutes()).padStart(2,"0");return`${I}-${w}-${b} ${$}:${z}`},se=s=>{const e=s.type.startsWith("image/"),I=s.size/1024/1024<10;return e?I?!0:(C.error("图片大小不能超过10MB"),!1):(C.error("只能上传图片文件"),!1)},oe=async s=>{const{file:e,onSuccess:I,onError:w}=s;try{const b=new FormData;b.append("file",e);const $=await U.post("/upload/single",b,{headers:{"Content-Type":"multipart/form-data"}}),z={url:$.data.url,fileName:$.data.fileName};I(z);const g=x.value.find(F=>F.uid===e.uid);g&&(g.url=$.data.url),Z(),C.success("图片上传成功")}catch(b){w(b),C.error("图片上传失败")}},ne=(s,e)=>{x.value=e,Z()},Z=()=>{i.images=x.value.map(s=>{var e;return s.url||((e=s.response)==null?void 0:e.url)}).filter(s=>s).join(","),A.value=x.value.map(s=>{var e;return s.url||((e=s.response)==null?void 0:e.url)}).filter(s=>s)},D=async()=>{E.value=!0;try{const s=await U.get("/order/page",{params:{page:V.page,size:V.size,orderNo:f.orderNo||void 0,petName:f.petName||void 0,status:f.status??void 0}});Y.value=s.data.records,V.total=s.data.total}catch(s){console.error("获取订单列表失败:",s)}finally{E.value=!1}},ee=()=>{V.page=1,D()},re=()=>{f.orderNo="",f.petName="",f.status=null,ee()},ue=s=>{u.value=s,O.value=!0},ie=async s=>{try{G.value=s.id;const e=await U.get(`/order/${s.id}/pets`);if(P.value=e.data,!P.value.length){C.error("该订单没有关联宠物");return}k.value=[],x.value=[],A.value=[],i.petIds=[],i.petNames="",i.images="",_.value=0,T.value=!0}catch(e){console.error("获取宠物信息失败:",e),C.error("获取宠物信息失败")}},de=async s=>{try{await le.confirm("确定要办理退房吗？","提示",{type:"warning"}),await U.post(`/order/${s.id}/check-out`),C.success("已办理退房"),D()}catch(e){e!=="cancel"&&console.error("办理退房失败:",e)}},pe=s=>{k.value=s},ce=async()=>{if(_.value===0){if(!k.value.length){C.error("请先选择宠物");return}i.petIds=k.value.map(s=>s.id),i.petNames=k.value.map(s=>s.name).join("、"),_.value=1}else if(_.value===1)try{j.value=!0,await U.post(`/order/${G.value}/check-in`,{petIds:i.petIds,petNames:i.petNames,careType:i.careType,content:i.content,images:i.images}),_.value=2}catch(s){console.error("办理入住失败:",s),C.error("办理入住失败")}finally{j.value=!1}},me=()=>{T.value=!1,D(),C.success("入住办理完成")},ve=()=>{_.value=0,i.petIds=[],i.petNames="",i.careType=6,i.content="",i.images="",x.value=[],A.value=[],P.value=[],k.value=[]},R=s=>({1:"猫咪",2:"狗狗",3:"异宠"})[s]||"未知",_e=async s=>{try{await le.confirm("确定要取消该订单吗？","提示",{type:"warning"}),await U.post(`/order/${s.id}/cancel`),C.success("订单已取消"),D()}catch(e){e!=="cancel"&&console.error("取消订单失败:",e)}};return Ie(()=>{D()}),(s,e)=>{const I=p("el-input"),w=p("el-form-item"),b=p("el-option"),$=p("el-select"),z=p("el-icon"),g=p("el-button"),F=p("el-form"),H=p("el-card"),c=p("el-table-column"),M=p("el-tag"),te=p("el-table"),fe=p("el-pagination"),v=p("el-descriptions-item"),ge=p("el-descriptions"),ae=p("el-dialog"),J=p("el-step"),ye=p("el-steps"),be=p("el-upload"),he=p("el-image"),ke=p("el-result"),we=De("loading");return r(),d("div",ze,[t(H,{shadow:"never",class:"search-form"},{default:a(()=>[t(F,{inline:!0,model:f},{default:a(()=>[t(w,{label:"订单号"},{default:a(()=>[t(I,{modelValue:f.orderNo,"onUpdate:modelValue":e[0]||(e[0]=l=>f.orderNo=l),placeholder:"请输入订单号",clearable:""},null,8,["modelValue"])]),_:1}),t(w,{label:"宠物名称"},{default:a(()=>[t(I,{modelValue:f.petName,"onUpdate:modelValue":e[1]||(e[1]=l=>f.petName=l),placeholder:"请输入宠物名称",clearable:""},null,8,["modelValue"])]),_:1}),t(w,{label:"状态"},{default:a(()=>[t($,{modelValue:f.status,"onUpdate:modelValue":e[2]||(e[2]=l=>f.status=l),placeholder:"全部状态",clearable:""},{default:a(()=>[t(b,{label:"待支付",value:0}),t(b,{label:"待入住",value:1}),t(b,{label:"已入住",value:2}),t(b,{label:"已完成",value:3}),t(b,{label:"已取消",value:4})]),_:1},8,["modelValue"])]),_:1}),t(w,null,{default:a(()=>[t(g,{type:"primary",onClick:ee},{default:a(()=>[t(z,null,{default:a(()=>[t(W(Ce))]),_:1}),e[11]||(e[11]=n("搜索 ",-1))]),_:1}),t(g,{onClick:re},{default:a(()=>[t(z,null,{default:a(()=>[t(W(Ne))]),_:1}),e[12]||(e[12]=n("重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(H,{shadow:"never"},{default:a(()=>[Se((r(),N(te,{data:Y.value,stripe:"",border:""},{default:a(()=>[t(c,{prop:"id",label:"ID",width:"80"}),t(c,{prop:"orderNo",label:"订单号",width:"180"}),t(c,{prop:"userName",label:"下单人",width:"120"}),t(c,{prop:"petNames",label:"宠物",width:"150"},{default:a(({row:l})=>[n(o(l.petNames||"未知"),1)]),_:1}),t(c,{prop:"roomNo",label:"房间号",width:"100"}),t(c,{prop:"checkInDate",label:"入住日期",width:"120"}),t(c,{prop:"checkOutDate",label:"退房日期",width:"120"}),t(c,{prop:"days",label:"天数",width:"80"}),t(c,{prop:"totalAmount",label:"总价(元)",width:"100"},{default:a(({row:l})=>[n(" ¥"+o(l.totalAmount||l.totalPrice||0),1)]),_:1}),t(c,{prop:"reviewScore",label:"用户评分",width:"120"},{default:a(({row:l})=>[l.reviewScore?(r(),d("span",Ue,[m("span",Te,o("★".repeat(l.reviewScore)),1)])):(r(),d("span",Me,"未评价"))]),_:1}),t(c,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[t(M,{type:X(l.status)},{default:a(()=>[n(o(Q(l.status)),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"createdAt",label:"创建时间",width:"180"},{default:a(({row:l})=>[n(o(q(l.createdAt)),1)]),_:1}),t(c,{label:"操作",width:"200",fixed:"right"},{default:a(({row:l})=>[t(g,{type:"primary",link:"",onClick:S=>ue(l)},{default:a(()=>[...e[13]||(e[13]=[n("详情",-1)])]),_:1},8,["onClick"]),l.status===1?(r(),N(g,{key:0,type:"warning",link:"",onClick:S=>ie(l)},{default:a(()=>[...e[14]||(e[14]=[n(" 办理入住 ",-1)])]),_:1},8,["onClick"])):y("",!0),l.status===2?(r(),N(g,{key:1,type:"info",link:"",onClick:S=>de(l)},{default:a(()=>[...e[15]||(e[15]=[n(" 办理退房 ",-1)])]),_:1},8,["onClick"])):y("",!0),l.status<=1?(r(),N(g,{key:2,type:"danger",link:"",onClick:S=>_e(l)},{default:a(()=>[...e[16]||(e[16]=[n(" 取消 ",-1)])]),_:1},8,["onClick"])):y("",!0)]),_:1})]),_:1},8,["data"])),[[we,E.value]]),t(fe,{class:"pagination","current-page":V.page,"onUpdate:currentPage":e[3]||(e[3]=l=>V.page=l),"page-size":V.size,"onUpdate:pageSize":e[4]||(e[4]=l=>V.size=l),"page-sizes":[10,20,50,100],total:V.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:D,onCurrentChange:D},null,8,["current-page","page-size","total"])]),_:1}),t(ae,{modelValue:O.value,"onUpdate:modelValue":e[5]||(e[5]=l=>O.value=l),title:"订单详情",width:"600px"},{default:a(()=>[t(ge,{column:2,border:""},{default:a(()=>[t(v,{label:"订单号"},{default:a(()=>[n(o(u.value.orderNo),1)]),_:1}),t(v,{label:"状态"},{default:a(()=>[t(M,{type:X(u.value.status)},{default:a(()=>[n(o(Q(u.value.status)),1)]),_:1},8,["type"])]),_:1}),t(v,{label:"下单人",span:2},{default:a(()=>[n(o(u.value.userName||"未知"),1)]),_:1}),t(v,{label:"手机号",span:2},{default:a(()=>[n(o(u.value.userPhone||"未知"),1)]),_:1}),t(v,{label:"宠物",span:2},{default:a(()=>[n(o(u.value.petNames||"未知"),1)]),_:1}),t(v,{label:"房间号"},{default:a(()=>[n(o(u.value.roomNo),1)]),_:1}),t(v,{label:"房型"},{default:a(()=>[n(o(u.value.roomType),1)]),_:1}),t(v,{label:"入住日期"},{default:a(()=>[n(o(u.value.checkInDate),1)]),_:1}),t(v,{label:"退房日期"},{default:a(()=>[n(o(u.value.checkOutDate),1)]),_:1}),t(v,{label:"入住天数"},{default:a(()=>[n(o(u.value.days)+"天",1)]),_:1}),t(v,{label:"订单总价"},{default:a(()=>[n("¥"+o(u.value.totalAmount||u.value.totalPrice||0),1)]),_:1}),t(v,{label:"商品明细",span:2},{default:a(()=>[u.value.items&&u.value.items.length?(r(),d("div",Pe,[(r(!0),d(L,null,B(u.value.items,(l,S)=>(r(),d("div",{key:S},o(l.productName)+" x"+o(l.quantity)+" (¥"+o(l.price)+") 小计¥"+o(l.subtotal),1))),128))])):(r(),d("span",Ae,"无"))]),_:1}),t(v,{label:"备注",span:2},{default:a(()=>[n(o(u.value.remark||"无"),1)]),_:1}),t(v,{label:"创建时间",span:2},{default:a(()=>[n(o(q(u.value.createdAt)),1)]),_:1}),t(v,{label:"用户评分",span:2},{default:a(()=>[u.value.reviewScore?(r(),d("div",Fe,[m("span",Le,o("★".repeat(u.value.reviewScore)),1),u.value.reviewCreatedAt?(r(),d("span",Be,o(q(u.value.reviewCreatedAt)),1)):y("",!0)])):(r(),d("span",Ee,"未评价"))]),_:1}),t(v,{label:"用户评价",span:2},{default:a(()=>[u.value.reviewContent?(r(),d("span",Oe,o(u.value.reviewContent),1)):(r(),d("span",je,"未填写"))]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ae,{modelValue:T.value,"onUpdate:modelValue":e[10]||(e[10]=l=>T.value=l),title:"办理入住",width:"780px",onClose:ve},{footer:a(()=>[m("div",tt,[t(g,{onClick:e[8]||(e[8]=l=>T.value=!1)},{default:a(()=>[...e[22]||(e[22]=[n("关闭",-1)])]),_:1}),_.value>0?(r(),N(g,{key:0,onClick:e[9]||(e[9]=l=>_.value--)},{default:a(()=>[...e[23]||(e[23]=[n(" 上一步 ",-1)])]),_:1})):y("",!0),_.value<2?(r(),N(g,{key:1,type:"primary",loading:j.value,onClick:ce},{default:a(()=>[n(o(_.value===0?"下一步":"确认入住"),1)]),_:1},8,["loading"])):y("",!0),_.value===2?(r(),N(g,{key:2,type:"success",onClick:me},{default:a(()=>[...e[24]||(e[24]=[n(" 完成 ",-1)])]),_:1})):y("",!0)])]),default:a(()=>[t(ye,{active:_.value,"finish-status":"success","align-center":"",class:"checkin-steps"},{default:a(()=>[t(J,{title:"选择宠物"}),t(J,{title:"登记护理信息"}),t(J,{title:"完成"})]),_:1},8,["active"]),_.value===0?(r(),d("div",qe,[m("div",Re,[e[17]||(e[17]=m("div",{class:"text-gray-600"},"该订单涉及的宠物信息：",-1)),k.value.length?(r(),N(M,{key:0,type:"info"},{default:a(()=>[n("已选 "+o(k.value.length)+" 只",1)]),_:1})):y("",!0)]),t(te,{data:P.value,stripe:"",border:"","max-height":"400px",onSelectionChange:pe},{default:a(()=>[t(c,{type:"selection",width:"55"}),t(c,{prop:"name",label:"宠物名称",width:"120"}),t(c,{label:"宠物类型",width:"100"},{default:a(({row:l})=>[n(o(R(l.type)),1)]),_:1}),t(c,{prop:"age",label:"年龄",width:"80"}),t(c,{prop:"weight",label:"体重(kg)",width:"100"}),t(c,{label:"健康备注","min-width":"200"},{default:a(({row:l})=>[n(o(l.notes||"无"),1)]),_:1})]),_:1},8,["data"])])):y("",!0),_.value===1?(r(),d("div",He,[t(F,{model:i,"label-width":"120px"},{default:a(()=>[t(w,{label:"已选宠物"},{default:a(()=>[m("div",Je,[(r(!0),d(L,null,B(k.value,l=>(r(),N(M,{key:l.id,class:"mr-2"},{default:a(()=>[n(o(l.name)+"（"+o(R(l.type))+"） ",1)]),_:2},1024))),128)),k.value.length===0?(r(),d("span",Ke,"未选择")):y("",!0)])]),_:1}),t(w,{label:"备注"},{default:a(()=>[t(I,{modelValue:i.content,"onUpdate:modelValue":e[6]||(e[6]=l=>i.content=l),type:"textarea",placeholder:"可选：其他备注信息",rows:"2"},null,8,["modelValue"])]),_:1}),t(w,{label:"宠物照片"},{default:a(()=>[t(be,{"file-list":x.value,"onUpdate:fileList":e[7]||(e[7]=l=>x.value=l),action:"#","list-type":"picture-card","http-request":oe,"before-upload":se,"on-remove":ne,accept:"image/*"},{default:a(()=>[t(z,null,{default:a(()=>[t(W(xe))]),_:1})]),_:1},8,["file-list"])]),_:1})]),_:1},8,["model"])])):y("",!0),_.value===2?(r(),d("div",We,[t(ke,{icon:"success",title:"入住办理成功","sub-title":"护理日志已记录"},{extra:a(()=>[t(H,{shadow:"never",class:"result-card"},{default:a(()=>[m("div",Ye,[e[18]||(e[18]=m("span",{class:"label"},"入住宠物",-1)),m("div",Ge,[(r(!0),d(L,null,B(k.value,l=>(r(),N(M,{key:l.id,class:"mr-2"},{default:a(()=>[n(o(l.name)+"（"+o(R(l.type))+"） ",1)]),_:2},1024))),128))])]),e[21]||(e[21]=m("div",{class:"result-row"},[m("span",{class:"label"},"护理类型"),m("span",{class:"value"},"入住登记")],-1)),m("div",Qe,[e[19]||(e[19]=m("span",{class:"label"},"备注",-1)),m("span",Xe,o(i.content||"无"),1)]),x.value.length?(r(),d("div",Ze,[e[20]||(e[20]=m("span",{class:"label"},"宠物照片",-1)),m("div",et,[(r(!0),d(L,null,B(x.value,l=>{var S;return r(),N(he,{key:l.uid||l.url,src:l.url||((S=l.response)==null?void 0:S.url),"preview-src-list":A.value,fit:"cover",class:"preview-item"},null,8,["src","preview-src-list"])}),128))])])):y("",!0)]),_:1})]),_:1})])):y("",!0)]),_:1},8,["modelValue"])])}}}),ut=$e(at,[["__scopeId","data-v-250cf7ec"]]);export{ut as default};
