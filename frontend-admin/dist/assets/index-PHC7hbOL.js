import{v as Re,r as m,l as De,c as Y,j as Ie,B as v,C as t,D as a,ak as s,n as Me,J as ee,aq as Oe,y as k,E as f,O as h,M as r,K as _,u as D,W as le,P as q,a4 as te,z as d}from"./vue-Oyw5Wt-7.js";import{u as ze,s as C}from"./index-BHoJcF0t.js";import{c as Ue,E as M,b as Ee}from"./elementPlus-BZK7s8Hm.js";import{_ as Se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const $e={class:"page-container"},Be={class:"card-header"},Ae={class:"role-name-cell"},Te={class:"card-header"},je={key:0,class:"empty-state"},qe={key:1,class:"permission-content"},Le={key:0,class:"admin-warning"},We={class:"group-header"},Fe={class:"group-content"},Je={key:1,class:"empty-tip"},Ke={key:2,class:"action-bar"},Ze=Re({__name:"index",setup(Ge){const I=ze(),O=m(!1),N=m([]),L=m(),c=m(null),V=m(!1),g=m(!1),z=m(!1),U=m(),n=De({id:void 0,roleName:"",roleCode:"",description:"",sortOrder:0,status:1}),ae={id:[{required:!0,message:"请输入角色ID",trigger:"blur"}],roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}],roleCode:[{required:!0,message:"请输入角色编码",trigger:"blur"},{pattern:/^[A-Z_]+$/,message:"角色编码只能包含大写字母和下划线",trigger:"blur"}]},E=m(!1),S=m(!1),W=m([]),i=m([]),$=m([]),P=Y(()=>{var l;return((l=c.value)==null?void 0:l.id)===9}),oe={dashboard:"工作台",hotel:"门店管理",staff:"员工管理",room:"房态管理",order:"订单管理",care:"护理日志",log:"日志管理",role:"角色管理",permission:"权限管理"},se=l=>oe[l]||l,R=Y(()=>{const l={};for(const e of W.value)l[e.module]||(l[e.module]=[]),l[e.module].push(e);return l}),F=l=>l!==void 0&&[1,2,9].includes(l),ne=l=>{const e=R.value[l]||[];return e.length>0&&e.every(u=>i.value.includes(u.id))},re=l=>{const e=R.value[l]||[],u=e.filter(p=>i.value.includes(p.id)).length;return u>0&&u<e.length},ie=(l,e)=>{const u=(R.value[l]||[]).map(p=>p.id);e?i.value=[...new Set([...i.value,...u])]:i.value=i.value.filter(p=>!u.includes(p))},de=(l,e)=>{e?i.value.includes(l)||i.value.push(l):i.value=i.value.filter(u=>u!==l)},B=async()=>{var l;O.value=!0;try{const e=await C.get("/role/list");N.value=e.data||[],N.value.length>0&&!c.value&&(await Me(),(l=L.value)==null||l.setCurrentRow(N.value[0]))}catch(e){console.error("获取角色列表失败:",e)}finally{O.value=!1}},ue=async()=>{try{const l=await C.get("/permission/list");W.value=l.data||[]}catch(l){console.error("获取权限列表失败:",l)}},ce=async l=>{E.value=!0;try{const e=await C.get(`/permission/role/${l}/ids`);i.value=e.data||[],$.value=[...i.value]}catch(e){console.error("获取角色权限失败:",e)}finally{E.value=!1}},me=l=>{l&&(c.value=l,ce(l.id))},pe=()=>{g.value=!1,Object.assign(n,{id:void 0,roleName:"",roleCode:"",description:"",sortOrder:0,status:1}),V.value=!0},ve=l=>{g.value=!0,Object.assign(n,{...l}),V.value=!0},fe=async()=>{var l;if(U.value){await U.value.validate(),z.value=!0;try{if(g.value?(await C.put("/role",n),M.success("修改成功")):(await C.post("/role",n),M.success("新增成功")),V.value=!1,await B(),g.value&&((l=c.value)==null?void 0:l.id)===n.id){const e=N.value.find(u=>u.id===n.id);e&&(c.value=e)}}catch(e){console.error("提交失败:",e)}finally{z.value=!1}}},_e=async l=>{var e;try{await Ee.confirm(`确定要删除角色"${l.roleName}"吗？`,"提示",{type:"warning"}),await C.delete(`/role/${l.id}`),M.success("删除成功"),((e=c.value)==null?void 0:e.id)===l.id&&(c.value=null,i.value=[]),B()}catch(u){u!=="cancel"&&console.error("删除失败:",u)}},ge=async()=>{if(c.value){S.value=!0;try{await C.put(`/permission/role/${c.value.id}`,{permIds:i.value}),M.success("权限配置保存成功"),$.value=[...i.value]}catch(l){console.error("保存权限失败:",l)}finally{S.value=!1}}},ye=()=>{i.value=[...$.value]};return Ie(()=>{B(),ue()}),(l,e)=>{const u=s("Plus"),p=s("el-icon"),y=s("el-button"),A=s("el-tag"),T=s("el-table-column"),J=s("el-card"),K=s("el-col"),Z=s("el-alert"),be=s("el-empty"),ke=s("Warning"),G=s("el-checkbox"),he=s("Check"),Ce=s("Refresh"),Ve=s("el-row"),H=s("el-input-number"),w=s("el-form-item"),j=s("el-input"),Q=s("el-radio"),we=s("el-radio-group"),xe=s("el-form"),Ne=s("el-dialog"),X=Oe("loading");return d(),v("div",$e,[t(Ve,{gutter:20},{default:a(()=>[t(K,{span:10},{default:a(()=>[t(J,{shadow:"never",class:"role-card"},{header:a(()=>[f("div",Be,[e[9]||(e[9]=f("span",null,"角色列表",-1)),D(I).hasPermission("role:add")?(d(),k(y,{key:0,type:"primary",size:"small",onClick:pe},{default:a(()=>[t(p,null,{default:a(()=>[t(u)]),_:1}),e[8]||(e[8]=r("新增 ",-1))]),_:1})):_("",!0)])]),default:a(()=>[ee((d(),k(D(Ue),{data:N.value,stripe:"",size:"small","highlight-current-row":"",onCurrentChange:me,ref_key:"roleTableRef",ref:L},{default:a(()=>[t(T,{prop:"roleName",label:"角色名称","min-width":"100"},{default:a(({row:o})=>[f("div",Ae,[f("span",null,h(o.roleName),1),t(A,{size:"small",type:"info"},{default:a(()=>[r(h(o.roleCode),1)]),_:2},1024)])]),_:1}),t(T,{prop:"status",label:"状态",width:"70"},{default:a(({row:o})=>[t(A,{size:"small",type:o.status===1?"success":"danger"},{default:a(()=>[r(h(o.status===1?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(T,{label:"操作",width:"100",fixed:"right"},{default:a(({row:o})=>[D(I).hasPermission("role:edit")?(d(),k(y,{key:0,type:"primary",link:"",size:"small",onClick:le(b=>ve(o),["stop"])},{default:a(()=>[...e[10]||(e[10]=[r(" 编辑 ",-1)])]),_:1},8,["onClick"])):_("",!0),D(I).hasPermission("role:delete")?(d(),k(y,{key:1,type:"danger",link:"",size:"small",onClick:le(b=>_e(o),["stop"]),disabled:F(o.id)},{default:a(()=>[...e[11]||(e[11]=[r(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])):_("",!0)]),_:1})]),_:1},8,["data"])),[[X,O.value]])]),_:1})]),_:1}),t(K,{span:14},{default:a(()=>[t(J,{shadow:"never",class:"permission-card"},{header:a(()=>[f("div",Te,[f("span",null,[e[12]||(e[12]=r(" 权限配置 ",-1)),c.value?(d(),v(q,{key:0},[r(" - "+h(c.value.roleName)+" ",1),t(A,{size:"small",style:{"margin-left":"8px"}},{default:a(()=>[r(h(c.value.roleCode),1)]),_:1})],64)):_("",!0)]),c.value?(d(),k(Z,{key:0,type:"info",closable:!1,"show-icon":"",style:{padding:"4px 8px","margin-left":"12px"}},{default:a(()=>[...e[13]||(e[13]=[r(" 修改后需重新登录生效 ",-1)])]),_:1})):_("",!0)])]),default:a(()=>[c.value?ee((d(),v("div",qe,[P.value?(d(),v("div",Le,[t(Z,{type:"warning",closable:!1,"show-icon":""},{title:a(()=>[t(p,null,{default:a(()=>[t(ke)]),_:1}),e[14]||(e[14]=r(" 超级管理员拥有所有权限，不允许修改 ",-1))]),_:1})])):_("",!0),(d(!0),v(q,null,te(R.value,(o,b)=>(d(),v("div",{key:b,class:"permission-group"},[f("div",We,[t(G,{"model-value":ne(b),indeterminate:re(b),disabled:P.value,onChange:x=>ie(b,x)},{default:a(()=>[r(h(se(b)),1)]),_:2},1032,["model-value","indeterminate","disabled","onChange"])]),f("div",Fe,[(d(!0),v(q,null,te(o,x=>(d(),k(G,{key:x.id,"model-value":i.value.includes(x.id),disabled:P.value,onChange:Pe=>de(x.id,Pe)},{default:a(()=>[r(h(x.permName),1)]),_:2},1032,["model-value","disabled","onChange"]))),128))])]))),128)),Object.keys(R.value).length===0?(d(),v("div",Je," 暂无权限数据 ")):_("",!0),D(I).hasPermission("permission:manage")?(d(),v("div",Ke,[t(y,{type:"primary",loading:S.value,disabled:P.value,onClick:ge},{default:a(()=>[t(p,null,{default:a(()=>[t(he)]),_:1}),e[15]||(e[15]=r("保存权限 ",-1))]),_:1},8,["loading","disabled"]),t(y,{onClick:ye,disabled:P.value},{default:a(()=>[t(p,null,{default:a(()=>[t(Ce)]),_:1}),e[16]||(e[16]=r("重置 ",-1))]),_:1},8,["disabled"])])):_("",!0)])),[[X,E.value]]):(d(),v("div",je,[t(be,{description:"请在左侧选择一个角色","image-size":100})]))]),_:1})]),_:1})]),_:1}),t(Ne,{modelValue:V.value,"onUpdate:modelValue":e[7]||(e[7]=o=>V.value=o),title:g.value?"编辑角色":"新增角色",width:"500px","close-on-click-modal":!1},{footer:a(()=>[t(y,{onClick:e[6]||(e[6]=o=>V.value=!1)},{default:a(()=>[...e[20]||(e[20]=[r("取消",-1)])]),_:1}),t(y,{type:"primary",loading:z.value,onClick:fe},{default:a(()=>[...e[21]||(e[21]=[r("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(xe,{ref_key:"formRef",ref:U,model:n,rules:ae,"label-width":"100px"},{default:a(()=>[g.value?_("",!0):(d(),k(w,{key:0,label:"角色ID",prop:"id"},{default:a(()=>[t(H,{modelValue:n.id,"onUpdate:modelValue":e[0]||(e[0]=o=>n.id=o),min:10,max:99,placeholder:"请输入角色ID（10-99）",style:{width:"100%"}},null,8,["modelValue"]),e[17]||(e[17]=f("div",{class:"form-tip"},"内置角色ID：1=员工，2=店长，9=超管，自定义角色请使用10-99",-1))]),_:1})),t(w,{label:"角色名称",prop:"roleName"},{default:a(()=>[t(j,{modelValue:n.roleName,"onUpdate:modelValue":e[1]||(e[1]=o=>n.roleName=o),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),t(w,{label:"角色编码",prop:"roleCode"},{default:a(()=>[t(j,{modelValue:n.roleCode,"onUpdate:modelValue":e[2]||(e[2]=o=>n.roleCode=o),placeholder:"请输入角色编码（如：AUDITOR）",disabled:g.value&&F(n.id)},null,8,["modelValue","disabled"])]),_:1}),t(w,{label:"角色描述",prop:"description"},{default:a(()=>[t(j,{modelValue:n.description,"onUpdate:modelValue":e[3]||(e[3]=o=>n.description=o),type:"textarea",rows:3,placeholder:"请输入角色描述"},null,8,["modelValue"])]),_:1}),t(w,{label:"排序",prop:"sortOrder"},{default:a(()=>[t(H,{modelValue:n.sortOrder,"onUpdate:modelValue":e[4]||(e[4]=o=>n.sortOrder=o),min:0,max:100},null,8,["modelValue"])]),_:1}),t(w,{label:"状态",prop:"status"},{default:a(()=>[t(we,{modelValue:n.status,"onUpdate:modelValue":e[5]||(e[5]=o=>n.status=o)},{default:a(()=>[t(Q,{value:1},{default:a(()=>[...e[18]||(e[18]=[r("正常",-1)])]),_:1}),t(Q,{value:0},{default:a(()=>[...e[19]||(e[19]=[r("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),el=Se(Ze,[["__scopeId","data-v-a2e1e595"]]);export{el as default};
