import{d as V,u as L,r as p,s as E,l as F,c as d,a as t,t as l,h as v,A as N,y as w,D as I,f as C,w as U,g as P,p as j,j as W,o as c}from"./index-ClhVCDrs.js";import{a as g,s as A,b as B,c as q}from"./message-CTPluzoh.js";const z={class:"max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},G={key:0,class:"text-center py-20"},H={key:1,class:"space-y-6"},J={class:"card"},K={class:"flex items-center space-x-6"},O={class:"w-20 h-20 bg-primary-100 rounded-full flex items-center justify-center"},Q={class:"text-3xl text-primary-600"},X={class:"text-xl font-semibold"},Y={class:"text-gray-500"},Z={class:"card"},$={class:"flex items-center gap-4"},tt={class:"w-14 h-14 bg-primary-100 rounded-full flex items-center justify-center overflow-hidden"},st=["src"],et={key:1,class:"text-xl text-primary-600"},at={class:"flex-1 space-y-2"},nt={class:"flex items-center gap-3"},ot=["disabled"],rt={class:"flex gap-4"},lt=["disabled"],it={class:"card"},dt={class:"grid grid-cols-2 gap-4"},mt=V({__name:"index",setup(ct){const M=W(),e=L(),x=p(!1),u=p(!1),f=p(!1),h=p(null),n=E({nickname:"",avatar:""}),R=()=>{var a;(a=h.value)==null||a.click()},S=async a=>{var i;const s=a.target,o=(i=s.files)==null?void 0:i[0];if(o){if(s.value="",o.size>10*1024*1024){g("å›¾ç‰‡ä¸èƒ½è¶…è¿‡10MB");return}if(!o.type.startsWith("image/")){g("åªæ”¯æŒå›¾ç‰‡æ–‡ä»¶");return}f.value=!0;try{const r=new FormData;r.append("file",o);const m=await j.post("/upload/single",r,{headers:{"Content-Type":"multipart/form-data"}});n.avatar=m.data.url,A("å¤´åƒä¸Šä¼ æˆåŠŸ")}catch(r){B(r.message||"å¤´åƒä¸Šä¼ å¤±è´¥")}finally{f.value=!1}}},D=async()=>{const a=n.nickname.trim(),s=n.avatar.trim();if(!a){g("è¯·è¾“å…¥æ˜µç§°");return}if(s&&!/^https?:\/\//i.test(s)){g("å¤´åƒURLæ ¼å¼ä¸æ­£ç¡®");return}u.value=!0;try{await j.put("/auth/user/profile",{nickname:a,avatar:s||void 0}),e.userInfo&&(e.userInfo.nickname=a,e.userInfo.avatar=s),A("ä¿®æ”¹æˆåŠŸ")}catch(o){B(o.message||"ä¿®æ”¹å¤±è´¥")}finally{u.value=!1}},T=async()=>{await q("ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ")&&(e.logout(),M.push("/"))};return F(()=>{(async()=>{var a,s;x.value=!0;try{e.userInfo||await e.fetchUserInfo(),n.nickname=((a=e.userInfo)==null?void 0:a.nickname)||"",n.avatar=((s=e.userInfo)==null?void 0:s.avatar)||""}finally{x.value=!1}})()}),(a,s)=>{var i,r,m,b,_,k;const o=P("router-link");return c(),d("div",z,[s[11]||(s[11]=t("h1",{class:"text-3xl font-bold text-gray-900 mb-8"},"ä¸ªäººä¸­å¿ƒ",-1)),x.value?(c(),d("div",G,[...s[2]||(s[2]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-4 border-primary-600 border-t-transparent"},null,-1)])])):(c(),d("div",H,[t("div",J,[s[3]||(s[3]=t("h2",{class:"text-lg font-semibold mb-4"},"åŸºæœ¬ä¿¡æ¯",-1)),t("div",K,[t("div",O,[t("span",Q,l(((r=(i=v(e).userInfo)==null?void 0:i.nickname)==null?void 0:r.charAt(0))||"ç”¨"),1)]),t("div",null,[t("h3",X,l(((m=v(e).userInfo)==null?void 0:m.nickname)||"ç”¨æˆ·"),1),t("p",Y,l((b=v(e).userInfo)==null?void 0:b.phone),1)])])]),t("div",Z,[s[7]||(s[7]=t("h2",{class:"text-lg font-semibold mb-4"},"ä¿®æ”¹ä¿¡æ¯",-1)),t("form",{onSubmit:N(D,["prevent"]),class:"space-y-4"},[t("div",null,[s[4]||(s[4]=t("div",{class:"text-sm text-gray-600 mb-1"},"æ˜µç§°",-1)),w(t("input",{"onUpdate:modelValue":s[0]||(s[0]=y=>n.nickname=y),class:"input-field",placeholder:"è¯·è¾“å…¥æ˜µç§°"},null,512),[[I,n.nickname]])]),t("div",null,[s[6]||(s[6]=t("div",{class:"text-sm text-gray-600 mb-1"},"å¤´åƒ",-1)),t("div",$,[t("div",tt,[n.avatar?(c(),d("img",{key:0,src:n.avatar,class:"w-14 h-14 object-cover"},null,8,st)):(c(),d("span",et,l(((k=(_=v(e).userInfo)==null?void 0:_.nickname)==null?void 0:k.charAt(0))||"ç”¨"),1))]),t("div",at,[w(t("input",{"onUpdate:modelValue":s[1]||(s[1]=y=>n.avatar=y),class:"input-field",placeholder:"å¤´åƒURLï¼ˆå¯é€‰ï¼‰"},null,512),[[I,n.avatar]]),t("div",nt,[t("input",{ref_key:"fileInputRef",ref:h,type:"file",accept:"image/*",class:"hidden",onChange:S},null,544),t("button",{type:"button",class:"btn-secondary",disabled:f.value,onClick:R},l(f.value?"ä¸Šä¼ ä¸­...":"ä¸Šä¼ å¤´åƒ"),9,ot),s[5]||(s[5]=t("div",{class:"text-xs text-gray-500"},"æ”¯æŒjpg/pngï¼Œå•å¼ â‰¤10MB",-1))])])])]),t("div",rt,[t("button",{type:"submit",disabled:u.value,class:"btn-primary"},l(u.value?"ä¿å­˜ä¸­...":"ä¿å­˜"),9,lt)])],32)]),t("div",it,[s[10]||(s[10]=t("h2",{class:"text-lg font-semibold mb-4"},"å¿«æ·å…¥å£",-1)),t("div",dt,[C(o,{to:"/pets",class:"p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors text-center"},{default:U(()=>[...s[8]||(s[8]=[t("span",{class:"text-2xl"},"ğŸ¾",-1),t("p",{class:"mt-2 font-medium"},"æˆ‘çš„å® ç‰©",-1)])]),_:1}),C(o,{to:"/orders",class:"p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors text-center"},{default:U(()=>[...s[9]||(s[9]=[t("span",{class:"text-2xl"},"ğŸ“‹",-1),t("p",{class:"mt-2 font-medium"},"æˆ‘çš„è®¢å•",-1)])]),_:1})])]),t("button",{onClick:T,class:"w-full py-3 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors font-medium"}," é€€å‡ºç™»å½• ")]))])}}});export{mt as default};
