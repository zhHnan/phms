import{d as A,r as m,s as O,I as S,l as T,c as o,a as e,e as w,k as D,t as n,F as E,m as G,A as R,y as d,D as c,z as W,p as v,o as i}from"./index-ClhVCDrs.js";import{a as V,s as h,b as _,c as J}from"./message-CTPluzoh.js";const L={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},H={key:0,class:"mb-6 text-sm text-gray-600"},K={class:"font-medium"},Q={class:"font-medium"},X={key:1,class:"text-center py-20"},Y={key:2,class:"text-center py-20"},Z={key:3,class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ee={class:"flex items-start justify-between"},te={class:"flex items-center space-x-4"},se={class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-3xl overflow-hidden"},le=["src","alt"],ae={key:1},ne={class:"text-xl font-semibold"},oe={class:"text-gray-500"},ie={class:"flex space-x-2"},re=["onClick"],de=["onClick"],ue={class:"mt-4 grid grid-cols-2 gap-4 text-sm"},me={class:"font-medium"},ce={class:"font-medium"},pe={class:"mt-4 p-3 bg-gray-50 rounded-lg text-sm"},ge={class:"grid grid-cols-2 gap-3"},ve={class:"font-medium"},ye={class:"font-medium"},fe={key:0,class:"mt-2 text-gray-700"},be={key:0,class:"mt-4 p-3 bg-yellow-50 rounded-lg"},xe={class:"text-sm text-yellow-800"},we={key:4,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},he={class:"bg-white rounded-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto"},ke={class:"text-xl font-semibold mb-4"},De={class:"flex items-center space-x-4"},Ve={class:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center overflow-hidden"},_e=["src"],Ue={key:1,class:"text-3xl"},Ce={class:"flex-1"},Ne=["disabled"],je={class:"grid grid-cols-2 gap-4"},Me={class:"flex justify-end space-x-4 pt-4"},Se=["disabled"],Be=A({__name:"index",setup($e){const r=m([]),y=m(!0),f=m(!1),b=m(!1),x=m(!1),p=m(null),U=m(null),l=O({name:"",type:"",age:null,weight:null,notes:"",photoUrl:"",rabiesVaccineDate:"",dewormingDate:"",vaccineNotes:""}),$=S(()=>r.value.filter(a=>!!a.rabiesVaccineDate).length),P=S(()=>r.value.filter(a=>!!a.dewormingDate).length),k=async()=>{y.value=!0;try{const a=await v.get("/pet/my-pets");r.value=a.data}catch(a){console.error("è·å–å® ç‰©åˆ—è¡¨å¤±è´¥:",a)}finally{y.value=!1}},C=()=>new Date().toISOString().slice(0,10),N=()=>{p.value=null,j(),l.rabiesVaccineDate=C(),l.dewormingDate=C(),x.value=!0},j=()=>{Object.assign(l,{name:"",type:"",age:null,weight:null,notes:"",photoUrl:"",rabiesVaccineDate:"",dewormingDate:"",vaccineNotes:""})},I=async a=>{var u;const t=a.target,s=(u=t.files)==null?void 0:u[0];if(s){if(!s.type.startsWith("image/")){V("è¯·ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶");return}if(s.size>5*1024*1024){V("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB");return}b.value=!0;try{const g=new FormData;g.append("file",s),g.append("bucket","phms");const z=await v.post("/upload/single",g,{headers:{"Content-Type":"multipart/form-data"}});l.photoUrl=z.data.url,h("ç…§ç‰‡ä¸Šä¼ æˆåŠŸ")}catch(g){_(g.message||"ç…§ç‰‡ä¸Šä¼ å¤±è´¥")}finally{b.value=!1,t&&(t.value="")}}},M=()=>{x.value=!1,p.value=null,j()},B=a=>{p.value=a,Object.assign(l,{name:a.name,type:a.type,age:a.age,weight:a.weight,notes:a.notes,photoUrl:a.photoUrl||"",rabiesVaccineDate:a.rabiesVaccineDate||"",dewormingDate:a.dewormingDate||"",vaccineNotes:a.vaccineNotes||""}),x.value=!0},F=async a=>{if(await J(`ç¡®å®šè¦åˆ é™¤ ${a.name} å—ï¼Ÿ`,"åˆ é™¤å® ç‰©"))try{await v.delete(`/pet/${a.id}`),r.value=r.value.filter(s=>s.id!==a.id),h("åˆ é™¤æˆåŠŸ")}catch(s){_(s.message||"åˆ é™¤å¤±è´¥")}},q=async()=>{if(!l.name||!l.type){V("è¯·å¡«å†™å® ç‰©åç§°å’Œç±»å‹");return}l.rabiesVaccineDate&&l.dewormingDate&&l.rabiesVaccineDate>l.dewormingDate,f.value=!0;try{const a={...l,type:Number(l.type),rabiesVaccineDate:l.rabiesVaccineDate||null,dewormingDate:l.dewormingDate||null,vaccineNotes:l.vaccineNotes||null};p.value?(await v.put("/pet",{...a,id:p.value.id}),await k(),h("ä¿®æ”¹æˆåŠŸ")):(await v.post("/pet",a),await k(),h("æ·»åŠ æˆåŠŸ")),M()}catch(a){_(a.message||"ä¿å­˜å¤±è´¥")}finally{f.value=!1}};return T(k),(a,t)=>(i(),o("div",L,[e("div",{class:"flex justify-between items-center mb-8"},[t[9]||(t[9]=e("h1",{class:"text-3xl font-bold text-gray-900"},"æˆ‘çš„å® ç‰©",-1)),e("button",{onClick:N,class:"btn-primary"}," + æ·»åŠ å® ç‰© ")]),y.value?w("",!0):(i(),o("div",H,[t[10]||(t[10]=D(" å·²è®°å½•ç‹‚çŠ¬ç–«è‹—ï¼š",-1)),e("span",K,n($.value),1),D("/"+n(r.value.length)+"ï¼Œ å·²è®°å½•é©±è™«ï¼š",1),e("span",Q,n(P.value),1),D("/"+n(r.value.length),1)])),y.value?(i(),o("div",X,[...t[11]||(t[11]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-4 border-primary-600 border-t-transparent"},null,-1)])])):r.value.length===0?(i(),o("div",Y,[t[12]||(t[12]=e("span",{class:"text-6xl"},"ğŸ¾",-1)),t[13]||(t[13]=e("p",{class:"mt-4 text-gray-600"},"è¿˜æ²¡æœ‰æ·»åŠ å® ç‰©",-1)),e("button",{onClick:N,class:"btn-primary mt-4"},"æ·»åŠ å® ç‰©")])):(i(),o("div",Z,[(i(!0),o(E,null,G(r.value,s=>(i(),o("div",{key:s.id,class:"card"},[e("div",ee,[e("div",te,[e("div",se,[s.photoUrl?(i(),o("img",{key:0,src:s.photoUrl,alt:s.name,class:"w-full h-full object-cover"},null,8,le)):(i(),o("span",ae,n(s.type===1?"ğŸ±":s.type===2?"ğŸ•":"ğŸ°"),1))]),e("div",null,[e("h3",ne,n(s.name),1),e("p",oe,n(s.type===1?"çŒ«å’ª":s.type===2?"ç‹—ç‹—":"å¼‚å® "),1)])]),e("div",ie,[e("button",{onClick:u=>B(s),class:"text-primary-600 hover:text-primary-700"},"ç¼–è¾‘",8,re),e("button",{onClick:u=>F(s),class:"text-red-500 hover:text-red-600"},"åˆ é™¤",8,de)])]),e("div",ue,[e("div",null,[t[14]||(t[14]=e("p",{class:"text-gray-500"},"å¹´é¾„",-1)),e("p",me,n(s.age?`${s.age}å²`:"æœªçŸ¥"),1)]),e("div",null,[t[15]||(t[15]=e("p",{class:"text-gray-500"},"ä½“é‡",-1)),e("p",ce,n(s.weight?`${s.weight}kg`:"æœªçŸ¥"),1)])]),e("div",pe,[t[18]||(t[18]=e("p",{class:"text-gray-700 font-medium mb-2"},"ç–«è‹—/é©±è™«",-1)),e("div",ge,[e("div",null,[t[16]||(t[16]=e("p",{class:"text-gray-500"},"ç‹‚çŠ¬ç–«è‹—",-1)),e("p",ve,n(s.rabiesVaccineDate?s.rabiesVaccineDate:"æœªè®°å½•"),1)]),e("div",null,[t[17]||(t[17]=e("p",{class:"text-gray-500"},"é©±è™«",-1)),e("p",ye,n(s.dewormingDate?s.dewormingDate:"æœªè®°å½•"),1)])]),s.vaccineNotes?(i(),o("div",fe," å¤‡æ³¨ï¼š"+n(s.vaccineNotes),1)):w("",!0)]),s.notes?(i(),o("div",be,[e("p",xe,"å¤‡æ³¨: "+n(s.notes),1)])):w("",!0)]))),128))])),x.value?(i(),o("div",we,[e("div",he,[e("h3",ke,n(p.value?"ç¼–è¾‘å® ç‰©":"æ·»åŠ å® ç‰©"),1),e("form",{onSubmit:R(q,["prevent"]),class:"space-y-4"},[e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"å® ç‰©ç…§ç‰‡",-1)),e("div",De,[e("div",Ve,[l.photoUrl?(i(),o("img",{key:0,src:l.photoUrl,alt:"å® ç‰©ç…§ç‰‡",class:"w-full h-full object-cover"},null,8,_e)):(i(),o("span",Ue,n(l.type===1?"ğŸ±":l.type===2?"ğŸ•":l.type===3?"ğŸ°":"ğŸ“·"),1))]),e("div",Ce,[e("input",{ref_key:"fileInput",ref:U,type:"file",accept:"image/*",onChange:I,class:"hidden"},null,544),e("button",{type:"button",onClick:t[0]||(t[0]=s=>{var u;return(u=U.value)==null?void 0:u.click()}),class:"btn-secondary text-sm",disabled:b.value},n(b.value?"ä¸Šä¼ ä¸­...":l.photoUrl?"æ›´æ¢ç…§ç‰‡":"ä¸Šä¼ ç…§ç‰‡"),9,Ne),t[19]||(t[19]=e("p",{class:"text-xs text-gray-500 mt-1"},"æ”¯æŒ JPGã€PNG æ ¼å¼",-1))])])]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"å® ç‰©åç§° *",-1)),d(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>l.name=s),required:"",class:"input-field",placeholder:"è¯·è¾“å…¥å® ç‰©åç§°"},null,512),[[c,l.name]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"å® ç‰©ç±»å‹ *",-1)),d(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>l.type=s),required:"",class:"input-field"},[...t[22]||(t[22]=[e("option",{value:""},"è¯·é€‰æ‹©",-1),e("option",{value:1},"çŒ«å’ª ğŸ±",-1),e("option",{value:2},"ç‹—ç‹— ğŸ•",-1),e("option",{value:3},"å¼‚å®  ğŸ°",-1)])],512),[[W,l.type,void 0,{number:!0}]])]),e("div",je,[e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"å¹´é¾„",-1)),d(e("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=s=>l.age=s),min:"0",class:"input-field",placeholder:"å²"},null,512),[[c,l.age,void 0,{number:!0}]])]),e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"ä½“é‡(kg)",-1)),d(e("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=s=>l.weight=s),min:"0",step:"0.1",class:"input-field"},null,512),[[c,l.weight,void 0,{number:!0}]])])]),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"å¥åº·/æ€§æ ¼å¤‡æ³¨",-1)),d(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=s=>l.notes=s),class:"input-field",rows:"3",placeholder:"å¦‚ï¼šç–«è‹—æƒ…å†µã€è¿‡æ•æºã€æ€§æ ¼ç‰¹ç‚¹ç­‰"},null,512),[[c,l.notes]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"ç‹‚çŠ¬ç–«è‹—æ¥ç§æ—¥æœŸ",-1)),d(e("input",{type:"date","onUpdate:modelValue":t[6]||(t[6]=s=>l.rabiesVaccineDate=s),class:"input-field"},null,512),[[c,l.rabiesVaccineDate]]),t[28]||(t[28]=e("p",{class:"text-xs text-gray-500 mt-1"},"ä¸æ¸…æ¥šå¯ä¸å¡«",-1))]),e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"é©±è™«æ—¥æœŸ",-1)),d(e("input",{type:"date","onUpdate:modelValue":t[7]||(t[7]=s=>l.dewormingDate=s),class:"input-field"},null,512),[[c,l.dewormingDate]])]),e("div",null,[t[30]||(t[30]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"ç–«è‹—/é©±è™«å¤‡æ³¨",-1)),d(e("textarea",{"onUpdate:modelValue":t[8]||(t[8]=s=>l.vaccineNotes=s),class:"input-field",rows:"2",placeholder:"å¦‚ï¼šæ¯3ä¸ªæœˆé©±è™«ä¸€æ¬¡ã€è¿‘æœŸæ‰“é’ˆååº”ç­‰"},null,512),[[c,l.vaccineNotes]])]),e("div",Me,[e("button",{type:"button",onClick:M,class:"btn-secondary"},"å–æ¶ˆ"),e("button",{type:"submit",disabled:f.value,class:"btn-primary"},n(f.value?"ä¿å­˜ä¸­...":"ä¿å­˜"),9,Se)])],32)])])):w("",!0)]))}});export{Be as default};
