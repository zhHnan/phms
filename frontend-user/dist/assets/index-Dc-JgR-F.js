import{d as he,r as b,I as k,s as J,l as ke,c as r,a as s,e as y,A as W,t as d,f as G,g as K,k as F,F as X,m as Z,y as w,D as C,z as _e,v as De,p as I,n as we,j as Ie,o as u,_ as Ne}from"./index-ClhVCDrs.js";import{a as g,s as ee,b as te}from"./message-CTPluzoh.js";const Pe={class:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},Ve={key:0,class:"text-center py-20"},Oe={class:"card"},Ce={class:"flex items-center space-x-4"},$e={class:"w-20 h-20 bg-gray-200 rounded-lg flex items-center justify-center text-4xl"},Se={class:"text-xl font-semibold"},Re={key:0,class:"text-gray-500"},je={key:1,class:"text-gray-500"},Te={class:"text-gray-500"},qe={class:"text-primary-600 font-bold"},Ue={class:"card"},Ae={key:0,class:"mt-4 p-4 bg-primary-50 rounded-lg"},Me={class:"text-primary-800"},Le={class:"text-xl"},Fe={key:0,class:"card"},ze={class:"flex gap-4 overflow-x-auto pb-2 product-scroll-h"},Ye={class:"flex flex-col gap-2 h-full"},Be={class:"w-full h-24 rounded bg-gray-100 overflow-hidden flex-shrink-0"},Qe=["src","alt"],Ee={key:1,class:"w-full h-full flex items-center justify-center text-gray-400 text-2xl"},He={class:"flex-1 min-w-0"},Je={class:"font-medium text-sm truncate"},We={class:"text-xs text-gray-500"},Ge={class:"text-xs text-gray-400 mt-1"},Ke={key:0,class:"text-xs text-gray-500 line-clamp-2"},Xe={class:"card"},Ze={class:"flex justify-between items-center mb-4"},et={class:"text-lg font-semibold"},tt={class:"text-sm text-gray-500 font-normal ml-2"},st={key:0,class:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg text-blue-700 text-sm"},lt={key:1,class:"mb-4 p-3 bg-purple-50 border border-purple-200 rounded-lg text-purple-700 text-sm"},at={key:2,class:"mb-4"},ot={class:"block text-sm font-medium text-gray-700 mb-2"},nt={class:"grid grid-cols-2 md:grid-cols-3 gap-4"},rt=["onClick"],ut={key:0,class:"absolute top-2 right-2 w-6 h-6 bg-primary-600 rounded-full flex items-center justify-center text-white text-xs"},dt={class:"text-2xl mb-2"},it={class:"font-medium"},ct={class:"text-sm text-gray-500"},mt={key:1,class:"text-xs text-gray-400"},pt={key:0,class:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm"},vt={key:1,class:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm"},yt={key:3,class:"text-center py-8 bg-gray-50 rounded-lg"},gt={class:"card"},ft={class:"flex justify-end space-x-4"},bt=["disabled"],xt={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},ht={class:"bg-white rounded-xl p-6 w-full max-w-md"},kt={class:"flex justify-end space-x-4 pt-4"},_t=["disabled"],Dt=he({__name:"index",setup(wt){const $=De(),se=Ie(),A=b(!0),S=b(!1),R=b(!1),N=b(!1),n=b(null),le=k(()=>{var t,e;return((t=n.value)==null?void 0:t.typeNameDisplay)||((e=n.value)==null?void 0:e.typeName)||""}),_=b([]),c=b([]),P=b([]),V=b({}),j=t=>{const e=t.getFullYear(),l=`${t.getMonth()+1}`.padStart(2,"0"),o=`${t.getDate()}`.padStart(2,"0");return`${e}-${l}-${o}`},ae=j(new Date),T=b([]),z=(()=>{const t=$.query.checkInDate,e=$.query.checkOutDate;if(t&&e)return{checkIn:t,checkOut:e};const l=new Date,o=new Date(l);return o.setDate(l.getDate()+3),{checkIn:j(l),checkOut:j(o)}})(),i=J({checkInDate:z.checkIn,checkOutDate:z.checkOut,remark:""});T.value=[i.checkInDate,i.checkOutDate];const oe=t=>{const e=new Date;return e.setHours(0,0,0,0),t<e},ne=t=>{if(!t||t.length!==2)return;let[e,l]=t;if(e===l){const o=new Date(e);o.setDate(o.getDate()+1),l=j(o),T.value=[e,l]}i.checkInDate=e,i.checkOutDate=l},M=t=>{const[e,l,o]=t.split("-").map(Number);return new Date(e,l-1,o)},m=J({name:"",type:"",age:null,weight:null,notes:""}),O=k(()=>{var e,l;const t=((l=(e=n.value)==null?void 0:e.typeName)==null?void 0:l.toLowerCase())||"";return t.includes("vip")||t.includes("å¥—é—´")}),Y=t=>{var l,o;if(O.value)return!0;const e=((o=(l=n.value)==null?void 0:l.typeName)==null?void 0:o.toLowerCase())||"";return e.includes("çŒ«")||e.includes("cat")?t===1:e.includes("ç‹—")||e.includes("dog")||e.includes("çŠ¬")?t===2:!0},re=()=>{var e,l;const t=((l=(e=n.value)==null?void 0:e.typeName)==null?void 0:l.toLowerCase())||"";return t.includes("çŒ«")||t.includes("cat")?"è¯¥æˆ¿é—´ä»…é™çŒ«å’ªå…¥ä½":t.includes("ç‹—")||t.includes("dog")||t.includes("çŠ¬")?"è¯¥æˆ¿é—´ä»…é™ç‹—ç‹—å…¥ä½":""},L=k(()=>{if(c.value.length<=1||O.value)return!0;const t=c.value.map(e=>{const l=_.value.find(o=>o.id===e);return l==null?void 0:l.type}).filter(Boolean);return new Set(t).size===1}),ue=(t,e)=>{var o,p;const l=c.value.indexOf(t);if(l>-1)c.value.splice(l,1);else{if(!Y(e)){g("è¯¥æˆ¿é—´ä¸å…è®¸è¯¥ç±»å‹çš„å® ç‰©å…¥ä½ï¼Œè¯·é€‰æ‹©å…¶ä»–å® ç‰©æˆ–é¢„è®¢VIPå¥—é—´");return}if(c.value.length>=(((o=n.value)==null?void 0:o.maxPetNum)||1)){g(`è¯¥æˆ¿é—´æœ€å¤šå®¹çº³ ${(p=n.value)==null?void 0:p.maxPetNum} åªå® ç‰©`);return}if(!O.value&&c.value.length>0){const v=_.value.find(f=>f.id===c.value[0]);if(v&&v.type!==e){g("è¯¥æˆ¿é—´ä¸å…è®¸ä¸åŒç±»å‹çš„å® ç‰©ä¸€èµ·å±…ä½ï¼Œä»…VIPé—´å…è®¸æ··æ­");return}}c.value.push(t)}},de=t=>({1:"ğŸ±",2:"ğŸ•",3:"ğŸ°"})[t]||"ğŸ¾",ie=t=>({1:"çŒ«å’ª",2:"ç‹—ç‹—",3:"å¼‚å® "})[t]||"æœªçŸ¥",q=k(()=>{if(!i.checkInDate||!i.checkOutDate)return 0;const t=new Date(i.checkInDate),e=new Date(i.checkOutDate),l=Math.ceil((e.getTime()-t.getTime())/(1e3*60*60*24));return l>0?l:0}),ce=k(()=>{var t;return(((t=n.value)==null?void 0:t.pricePerNight)||0)*q.value+me.value}),me=k(()=>P.value.reduce((t,e)=>{const l=V.value[e.id]||0;return t+l*e.price},0)),pe=k(()=>Object.entries(V.value).map(([t,e])=>({productId:Number(t),quantity:Number(e)})).filter(t=>t.quantity>0)),ve=k(()=>{var t;return c.value.length>0&&c.value.length<=(((t=n.value)==null?void 0:t.maxPetNum)||1)&&L.value&&i.checkInDate&&i.checkOutDate&&q.value>0}),ye=t=>{const e=t.toLowerCase();return e.includes("çŒ«")||e.includes("cat")?"ğŸ±":e.includes("ç‹—")||e.includes("dog")||e.includes("çŠ¬")?"ğŸ•":"ğŸ "},ge=async()=>{var t;A.value=!0;try{const[e,l]=await Promise.all([I.get(`/room/${$.params.roomId}`),I.get("/pet/my-pets")]);if(n.value=e.data||e,_.value=l.data||l,(t=n.value)!=null&&t.hotelId){const o=await I.get("/product/user/list",{params:{hotelId:n.value.hotelId}});P.value=o.data||[];const p=fe(),v={};P.value.forEach(f=>{const x=p.find(D=>D.productId===f.id);v[f.id]=x?x.quantity:0}),V.value=v}}catch(e){console.error("è·å–æ•°æ®å¤±è´¥:",e)}finally{A.value=!1}},fe=()=>{const t=$.query.products;if(!t)return[];try{const e=decodeURIComponent(t),l=JSON.parse(e);if(Array.isArray(l))return l}catch{return[]}return[]},be=async()=>{var e,l;if(!m.name||!m.type){g("è¯·å¡«å†™å® ç‰©åç§°å’Œç±»å‹");return}const t=Number(m.type);if(!t||t<1||t>3){g("è¯·é€‰æ‹©æœ‰æ•ˆçš„å® ç‰©ç±»å‹");return}R.value=!0;try{const o={name:m.name,type:t,age:m.age||null,weight:m.weight||null,notes:m.notes||""};console.log("æäº¤å® ç‰©æ•°æ®:",o),await I.post("/pet",o);const p=await I.get("/pet/my-pets");_.value=p.data||p,N.value=!1,Object.assign(m,{name:"",type:"",age:null,weight:null,notes:""}),ee("æ·»åŠ å® ç‰©æˆåŠŸï¼")}catch(o){te(((l=(e=o.response)==null?void 0:e.data)==null?void 0:l.message)||o.message||"æ·»åŠ å® ç‰©å¤±è´¥")}finally{R.value=!1}},xe=async()=>{var o,p,v,f,x,D;if(!i.checkInDate||!i.checkOutDate){g("è¯·é€‰æ‹©å…¥ä½å’Œé€€æˆ¿æ—¥æœŸ");return}const t=M(ae),e=M(i.checkInDate),l=M(i.checkOutDate);if(e<t){g("å…¥ä½æ—¥æœŸä¸èƒ½æ—©äºä»Šå¤©");return}if(l<=e){g("é€€æˆ¿æ—¥æœŸå¿…é¡»æ™šäºå…¥ä½æ—¥æœŸ");return}if(c.value.length===0){g("è¯·è‡³å°‘é€‰æ‹©ä¸€åªå® ç‰©");return}if(c.value.length>(((o=n.value)==null?void 0:o.maxPetNum)||1)){g(`è¯¥æˆ¿é—´æœ€å¤šå®¹çº³ ${(p=n.value)==null?void 0:p.maxPetNum} åªå® ç‰©ï¼Œè¯·å‡å°‘é€‰æ‹©`);return}if(!L.value){g("è¯¥æˆ¿é—´ä¸å…è®¸ä¸åŒç±»å‹çš„å® ç‰©ä¸€èµ·å±…ä½ï¼Œä»…VIPé—´å…è®¸æ··æ­");return}S.value=!0;try{const h=await I.post("/order",{hotelId:(v=n.value)==null?void 0:v.hotelId,roomId:(f=n.value)==null?void 0:f.id,petIds:c.value,checkInDate:i.checkInDate,checkOutDate:i.checkOutDate,remark:i.remark,items:pe.value}),U=h.data||h;ee(`é¢„è®¢æˆåŠŸï¼è®¢å•å·ï¼š${U.orderNo}
è¯·åœ¨1åˆ†é’Ÿå†…å®Œæˆæ”¯ä»˜ï¼Œå¦åˆ™è®¢å•å°†è¢«è‡ªåŠ¨å–æ¶ˆ`),se.push("/orders")}catch(h){te(((D=(x=h.response)==null?void 0:x.data)==null?void 0:D.message)||h.message||"é¢„è®¢å¤±è´¥")}finally{S.value=!1}};ke(ge);const B=t=>{if(!t)return[];try{return JSON.parse(t)}catch{return[]}};return(t,e)=>{var p,v,f,x,D,h,U,Q,E;const l=K("el-date-picker"),o=K("el-input-number");return u(),r("div",Pe,[s("button",{onClick:e[0]||(e[0]=a=>t.$router.back()),class:"flex items-center text-gray-600 hover:text-primary-600 mb-6"},[...e[12]||(e[12]=[s("span",null,"â† è¿”å›",-1)])]),e[29]||(e[29]=s("h1",{class:"text-3xl font-bold text-gray-900 mb-8"},"é¢„è®¢æˆ¿é—´",-1)),A.value?(u(),r("div",Ve,[...e[13]||(e[13]=[s("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-4 border-primary-600 border-t-transparent"},null,-1)])])):(u(),r("form",{key:1,onSubmit:W(xe,["prevent"]),class:"space-y-6"},[s("div",Oe,[e[14]||(e[14]=s("h2",{class:"text-lg font-semibold mb-4"},"æˆ¿é—´ä¿¡æ¯",-1)),s("div",Ce,[s("div",$e,d(ye(((p=n.value)==null?void 0:p.typeName)||"")),1),s("div",null,[s("h3",Se,d(le.value),1),(v=n.value)!=null&&v.hotelName?(u(),r("p",Re,d(n.value.hotelName),1)):y("",!0),(f=n.value)!=null&&f.hotelAddress?(u(),r("p",je,d(n.value.hotelAddress),1)):y("",!0),s("p",Te,"æˆ¿é—´å·: "+d((x=n.value)==null?void 0:x.roomNo),1),s("p",qe,"Â¥"+d((D=n.value)==null?void 0:D.pricePerNight)+"/å¤©",1)])])]),s("div",Ue,[e[17]||(e[17]=s("h2",{class:"text-lg font-semibold mb-4"},"å…¥ä½ä¿¡æ¯",-1)),G(l,{modelValue:T.value,"onUpdate:modelValue":e[1]||(e[1]=a=>T.value=a),type:"daterange","range-separator":"è‡³","start-placeholder":"å…¥ä½æ—¥æœŸ","end-placeholder":"é€€æˆ¿æ—¥æœŸ","value-format":"YYYY-MM-DD","disabled-date":oe,onChange:ne,class:"w-full"},null,8,["modelValue"]),q.value>0?(u(),r("div",Ae,[s("p",Me,[e[15]||(e[15]=F(" å…¥ä½ ",-1)),s("strong",null,d(q.value),1),e[16]||(e[16]=F(" å¤©ï¼Œé¢„è®¡è´¹ç”¨: ",-1)),s("strong",Le,"Â¥"+d(ce.value),1)])])):y("",!0)]),P.value.length?(u(),r("div",Fe,[e[18]||(e[18]=s("h2",{class:"text-lg font-semibold mb-4"},"å•†å“é€‰è´­",-1)),s("div",ze,[(u(!0),r(X,null,Z(P.value,a=>(u(),r("div",{key:a.id,class:"p-4 border rounded-lg flex-shrink-0 w-48"},[s("div",Ye,[s("div",Be,[B(a.images).length?(u(),r("img",{key:0,src:B(a.images)[0],alt:a.name,class:"w-full h-full object-cover"},null,8,Qe)):(u(),r("div",Ee,"ğŸ“¦"))]),s("div",He,[s("p",Je,d(a.name),1),s("p",We,"Â¥"+d(a.price)+" / ä»¶",1),s("p",Ge,"åº“å­˜ï¼š"+d(a.stock),1)]),G(o,{modelValue:V.value[a.id],"onUpdate:modelValue":H=>V.value[a.id]=H,min:0,max:a.stock,size:"small",class:"w-full"},null,8,["modelValue","onUpdate:modelValue","max"]),a.description?(u(),r("p",Ke,d(a.description),1)):y("",!0)])]))),128))])])):y("",!0),s("div",Xe,[s("div",Ze,[s("h2",et,[e[19]||(e[19]=F(" å® ç‰©ä¿¡æ¯ ",-1)),s("span",tt," (å·²é€‰ "+d(c.value.length)+"/"+d(((h=n.value)==null?void 0:h.maxPetNum)||0)+") ",1)])]),O.value?(u(),r("div",lt," âœ¨ ä»…VIPé—´å…è®¸ä¸åŒå® ç‰©ä¸€èµ·å±…ä½ ")):(u(),r("div",st," â„¹ï¸ "+d(re()),1)),_.value.length>0?(u(),r("div",at,[s("label",ot," é€‰æ‹©å® ç‰©ï¼ˆæœ€å¤š "+d(((U=n.value)==null?void 0:U.maxPetNum)||1)+" åªï¼‰ ",1),s("div",nt,[(u(!0),r(X,null,Z(_.value,a=>(u(),r("div",{key:a.id,onClick:H=>ue(a.id,a.type),class:we(["p-4 border rounded-lg cursor-pointer transition-all relative",[{"opacity-50 cursor-not-allowed":!Y(a.type)},c.value.includes(a.id)?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-gray-300"]])},[c.value.includes(a.id)?(u(),r("div",ut," âœ“ ")):y("",!0),s("div",dt,d(de(a.type)),1),s("p",it,d(a.name),1),s("p",ct,d(ie(a.type)),1),a.weight?(u(),r("p",mt,d(a.weight)+"kg",1)):y("",!0)],10,rt))),128))]),c.value.length>(((Q=n.value)==null?void 0:Q.maxPetNum)||1)?(u(),r("div",pt," âš ï¸ å·²è¶…å‡ºæˆ¿é—´æœ€å¤§å®¹é‡ï¼ˆ"+d((E=n.value)==null?void 0:E.maxPetNum)+" åªï¼‰ï¼Œè¯·å‡å°‘å® ç‰©æ•°é‡ ",1)):y("",!0),!O.value&&c.value.length>1&&!L.value?(u(),r("div",vt," âš ï¸ è¯¥æˆ¿é—´ä¸å…è®¸ä¸åŒç±»å‹çš„å® ç‰©ä¸€èµ·å±…ä½ï¼Œè¯·é€‰æ‹©ç›¸åŒç±»å‹çš„å® ç‰©æˆ–é¢„è®¢VIPå¥—é—´ ")):y("",!0)])):(u(),r("div",yt,[e[20]||(e[20]=s("p",{class:"text-gray-600 mb-4"},"æ‚¨è¿˜æ²¡æœ‰æ·»åŠ å® ç‰©ä¿¡æ¯ï¼Œæ— æ³•é¢„è®¢",-1)),s("button",{type:"button",onClick:e[2]||(e[2]=a=>N.value=!0),class:"btn-primary"}," ç«‹å³æ·»åŠ å® ç‰© ")])),_.value.length>0?(u(),r("button",{key:4,type:"button",onClick:e[3]||(e[3]=a=>N.value=!0),class:"text-primary-600 hover:text-primary-700 text-sm mt-4"}," + æ·»åŠ æ–°å® ç‰© ")):y("",!0)]),s("div",gt,[e[21]||(e[21]=s("h2",{class:"text-lg font-semibold mb-4"},"å¤‡æ³¨ä¿¡æ¯",-1)),w(s("textarea",{"onUpdate:modelValue":e[4]||(e[4]=a=>i.remark=a),rows:"3",class:"input-field",placeholder:"è¯·å¡«å†™å® ç‰©çš„ç‰¹æ®Šéœ€æ±‚ã€é¥®é£Ÿä¹ æƒ¯ã€å¥åº·çŠ¶å†µç­‰"},null,512),[[C,i.remark]])]),s("div",ft,[s("button",{type:"button",onClick:e[5]||(e[5]=a=>t.$router.back()),class:"btn-secondary"}," å–æ¶ˆ "),s("button",{type:"submit",disabled:!ve.value||S.value,class:"btn-primary disabled:opacity-50"},d(S.value?"æäº¤ä¸­...":"ç¡®è®¤é¢„è®¢"),9,bt)])],32)),N.value?(u(),r("div",xt,[s("div",ht,[e[28]||(e[28]=s("h3",{class:"text-xl font-semibold mb-4"},"æ·»åŠ å® ç‰©",-1)),s("form",{onSubmit:W(be,["prevent"]),class:"space-y-4"},[s("div",null,[e[22]||(e[22]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"å® ç‰©åç§° *",-1)),w(s("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>m.name=a),required:"",class:"input-field",placeholder:"è¯·è¾“å…¥å® ç‰©åç§°"},null,512),[[C,m.name]])]),s("div",null,[e[24]||(e[24]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"å® ç‰©ç±»å‹ *",-1)),w(s("select",{"onUpdate:modelValue":e[7]||(e[7]=a=>m.type=a),required:"",class:"input-field"},[...e[23]||(e[23]=[s("option",{value:""},"è¯·é€‰æ‹©",-1),s("option",{value:1},"çŒ«å’ª ğŸ±",-1),s("option",{value:2},"ç‹—ç‹— ğŸ•",-1),s("option",{value:3},"å¼‚å®  ğŸ°",-1)])],512),[[_e,m.type,void 0,{number:!0}]])]),s("div",null,[e[25]||(e[25]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"å¹´é¾„(å²)",-1)),w(s("input",{type:"number","onUpdate:modelValue":e[8]||(e[8]=a=>m.age=a),min:"0",max:"30",class:"input-field",placeholder:"é€‰å¡«"},null,512),[[C,m.age,void 0,{number:!0}]])]),s("div",null,[e[26]||(e[26]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"ä½“é‡(kg)",-1)),w(s("input",{type:"number","onUpdate:modelValue":e[9]||(e[9]=a=>m.weight=a),min:"0",step:"0.1",class:"input-field",placeholder:"é€‰å¡«"},null,512),[[C,m.weight,void 0,{number:!0}]])]),s("div",null,[e[27]||(e[27]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"å¥åº·/æ€§æ ¼å¤‡æ³¨",-1)),w(s("textarea",{"onUpdate:modelValue":e[10]||(e[10]=a=>m.notes=a),class:"input-field",rows:"3",placeholder:"å¦‚ï¼šç–«è‹—æƒ…å†µã€è¿‡æ•æºã€æ€§æ ¼ç‰¹ç‚¹ç­‰"},null,512),[[C,m.notes]])]),s("div",kt,[s("button",{type:"button",onClick:e[11]||(e[11]=a=>N.value=!1),class:"btn-secondary"},"å–æ¶ˆ"),s("button",{type:"submit",disabled:R.value,class:"btn-primary"},d(R.value?"æ·»åŠ ä¸­...":"ç¡®è®¤æ·»åŠ "),9,_t)])],32)])])):y("",!0)])}}}),Vt=Ne(Dt,[["__scopeId","data-v-8066c894"]]);export{Vt as default};
