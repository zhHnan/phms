import{d as ct,r,I as ut,B as dt,l as mt,x as vt,c as n,a,f as q,i as pt,F as A,m as H,w as P,g as gt,e as d,T as xt,t as i,G as yt,p as C,n as S,k as F,h as ht,A as N,o}from"./index-ClhVCDrs.js";import{c as W,s as j,b as B}from"./message-CTPluzoh.js";import{f as ft}from"./datetime-C5mOaQky.js";const _t={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},wt={class:"flex space-x-4 mb-6 overflow-x-auto"},bt=["onClick"],kt={key:0,class:"text-center py-20"},Tt={key:1,class:"text-center py-20"},Ct={key:2,class:"space-y-4"},Nt=["onClick"],$t={class:"flex justify-between items-start mb-4"},It={class:"text-sm text-gray-500"},Ot={class:"text-sm text-gray-500"},St={key:0,class:"text-sm text-gray-500 mt-1"},jt={key:0},Bt={key:1,class:"text-red-600"},Et={class:"flex items-center space-x-4"},Mt={class:"w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center text-3xl"},Dt={class:"flex-1"},Rt={class:"font-semibold mb-1"},zt={key:0},Ut={key:1,class:"text-gray-400"},Vt={class:"text-gray-500 text-sm"},qt={key:0},At={key:1},Ht={key:2},Pt={key:3,class:"text-gray-400"},Ft={class:"text-gray-500 text-sm"},Wt={key:0},Yt={class:"text-right"},Gt={class:"text-xl font-bold text-primary-600"},Jt={key:0,class:"mt-4 pt-4 border-t flex justify-end space-x-4"},Kt=["onClick"],Lt=["onClick"],Qt={key:1,class:"mt-4 pt-4 border-t flex justify-end space-x-4"},Xt=["onClick"],Zt={key:2,class:"mt-4 pt-4 border-t flex justify-end space-x-4"},te=["onClick"],ee={key:0,class:"text-center py-4 text-gray-500"},se={key:1,class:"text-center py-4 text-gray-400"},ae={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},oe={class:"relative bg-white rounded-2xl shadow-xl w-[360px] p-6"},ne={class:"text-sm text-gray-500"},le={class:"mt-4 flex flex-col items-center gap-3"},ie={class:"w-48 h-48 rounded-xl border border-gray-200 flex items-center justify-center bg-gray-50"},re=["src"],ce={key:1,class:"text-gray-400"},ue={key:0,class:"text-xs text-gray-400"},de={key:1,class:"text-xs text-green-600"},me={class:"mt-6 flex gap-3"},ve=["disabled"],pe=1,fe=ct({__name:"index",setup(ge){const Y=[{label:"å…¨éƒ¨",value:""},{label:"å¾…æ”¯ä»˜",value:"0"},{label:"å¾…å…¥ä½",value:"1"},{label:"å·²å…¥ä½",value:"2"},{label:"å·²å®Œæˆ",value:"3"},{label:"å·²å–æ¶ˆ",value:"4"}],c=r([]),f=r(!0),$=r(!1),x=r(""),_=r(1),E=r(10),M=r(0),y=r(!1),w=r(!0),D=r(!1),I=r(!1),h=r("waiting"),p=r(null),v=r(null),R=ut(()=>{var e;if(!((e=p.value)!=null&&e.id))return"";const t=`${window.location.origin}/api/order/${p.value.id}/pay-scan`;return`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(t)}`}),G=t=>({0:"å¾…æ”¯ä»˜",1:"å¾…å…¥ä½",2:"å·²å…¥ä½",3:"å·²å®Œæˆ",4:"å·²å–æ¶ˆ"})[t]||"æœªçŸ¥",J=t=>({0:"bg-yellow-100 text-yellow-800",1:"bg-blue-100 text-blue-800",2:"bg-green-100 text-green-800",3:"bg-gray-100 text-gray-800",4:"bg-red-100 text-red-800"})[t]||"bg-gray-100 text-gray-800";let g=null;const b=t=>{if(t.status!==0)return 0;const l=new Date(t.createdAt).getTime()+pe*60*1e3,u=Date.now();return Math.max(0,l-u)},K=t=>{const e=Math.floor(t/1e3),l=Math.floor(e/60),u=e%60;return`${l}åˆ†${u}ç§’`},L=t=>{const e=b(t);return e===0?"text-red-600":e<30*1e3?"text-orange-600":"text-yellow-600"},Q=()=>{g&&clearInterval(g);const t=new Set;g=window.setInterval(()=>{let e=!1;c.value.forEach(l=>{l.status===0&&b(l)===0&&!t.has(l.id)&&(t.add(l.id),e=!0)}),e&&setTimeout(()=>{k()},2e3),c.value=[...c.value]},1e3)},X=()=>{g&&(clearInterval(g),g=null)},Z=t=>({cat_standard:"çŒ«å’ªæ ‡é—´",cat_deluxe:"çŒ«å’ªè±ªåé—´",dog_standard:"ç‹—ç‹—æ ‡é—´",dog_deluxe:"ç‹—ç‹—è±ªåé—´",vip_suite:"VIPå¥—é—´"})[t]||t,tt=t=>t!=null&&t.startsWith("cat")?"ğŸ±":t!=null&&t.startsWith("dog")?"ğŸ•":"ğŸ‘‘",z=t=>{if(t.pets&&t.pets.length>0)return t.pets.map(e=>e.name);if(t.petName)return[t.petName];if(t.petIds)try{const e=typeof t.petIds=="string"?JSON.parse(t.petIds):t.petIds;if(e.length>0)return[`${e.length}åªå® ç‰©`]}catch{return[]}return[]},k=async(t=!1)=>{var e,l;if(t&&y.value)return!1;t||(f.value=!0),t&&(y.value=!0);try{const u={page:_.value,size:E.value};x.value&&(u.status=x.value);const s=await C.get("/order/my-orders",{params:u}),m=((e=s.data)==null?void 0:e.records)||[],O=typeof((l=s.data)==null?void 0:l.total)=="number"?s.data.total:null;O!==null&&(M.value=O),t?c.value=[...c.value,...m]:c.value=m;const lt=c.value.length,it=O!==null?lt>=M.value:!1,rt=m.length<E.value;return w.value=!(it||rt),!0}catch(u){return console.error("è·å–è®¢å•å¤±è´¥:",u),!1}finally{t?y.value=!1:f.value=!1}},et=async()=>{if(f.value||y.value||!w.value)return;_.value+=1,await k(!0)||(_.value-=1)},U=async t=>{if(await W("ç¡®å®šè¦å–æ¶ˆè¯¥è®¢å•å—ï¼Ÿ"))try{await C.post(`/order/${t.id}/cancel`),t.status=4,j("å·²å–æ¶ˆè®¢å•")}catch(e){B(e.message||"å–æ¶ˆå¤±è´¥")}},st=async t=>{if(await W("ç¡®å®šè¦åˆ é™¤è¯¥è®¢å•å—ï¼Ÿ"))try{await C.delete(`/order/${t.id}`),c.value=c.value.filter(e=>e.id!==t.id),j("è®¢å•å·²åˆ é™¤")}catch(e){B(e.message||"åˆ é™¤å¤±è´¥")}},at=async t=>{p.value=t,ot()},ot=()=>{$.value=!1,h.value="waiting",I.value=!0,v.value&&window.clearTimeout(v.value),v.value=window.setTimeout(async()=>{if(p.value)try{await C.get(`/order/${p.value.id}/pay-scan`),p.value.status=1,h.value="success",j("æ”¯ä»˜æˆåŠŸï¼è¯·åœ¨å…¥ä½å½“å¤©12:00ååŠç†å…¥ä½æ‰‹ç»­"),T()}catch(t){B(t.message||"æ”¯ä»˜å¤±è´¥"),h.value="waiting"}},1e4)},T=()=>{v.value&&window.clearTimeout(v.value),v.value=null,$.value=!1,I.value=!1,h.value="waiting"},V=()=>{D.value=window.scrollY>400;const t=window.scrollY,e=window.innerHeight,l=document.documentElement.scrollHeight;t+e>=l-200&&et()},nt=()=>{window.scrollTo({top:0,behavior:"smooth"})};return dt(x,async()=>{_.value=1,w.value=!0,c.value=[],await k()}),mt(async()=>{await k(),Q(),window.addEventListener("scroll",V)}),vt(()=>{X(),v.value&&window.clearTimeout(v.value),window.removeEventListener("scroll",V)}),(t,e)=>{var u;const l=gt("router-link");return o(),n("div",_t,[e[7]||(e[7]=a("h1",{class:"text-3xl font-bold text-gray-900 mb-8"},"æˆ‘çš„è®¢å•",-1)),a("div",wt,[(o(),n(A,null,H(Y,s=>a("button",{key:s.value,onClick:m=>x.value=s.value,class:S(["px-4 py-2 rounded-lg whitespace-nowrap transition-colors",x.value===s.value?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},i(s.label),11,bt)),64))]),f.value?(o(),n("div",kt,[...e[0]||(e[0]=[a("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-4 border-primary-600 border-t-transparent"},null,-1)])])):c.value.length===0?(o(),n("div",Tt,[e[2]||(e[2]=a("span",{class:"text-6xl"},"ğŸ“‹",-1)),e[3]||(e[3]=a("p",{class:"mt-4 text-gray-600"},"æš‚æ— è®¢å•",-1)),q(l,{to:"/rooms",class:"btn-primary inline-block mt-4"},{default:P(()=>[...e[1]||(e[1]=[F("å»é¢„è®¢",-1)])]),_:1})])):(o(),n("div",Ct,[(o(!0),n(A,null,H(c.value,s=>(o(),n("div",{key:s.id,class:"card cursor-pointer hover:shadow-lg transition-shadow",onClick:m=>t.$router.push(`/orders/${s.id}`)},[a("div",$t,[a("div",null,[a("p",It,"è®¢å•å·: "+i(s.orderNo),1),a("p",Ot,i(ht(ft)(s.createdAt)),1),s.hotelName?(o(),n("p",St,"ğŸ¨ "+i(s.hotelName),1)):d("",!0),s.status===0?(o(),n("p",{key:1,class:S(["text-sm font-medium mt-1",L(s)])},[b(s)>0?(o(),n("span",jt," â° "+i(K(b(s)))+" åè¶…æ—¶ ",1)):(o(),n("span",Bt," å·²è¶…æ—¶ï¼Œè®¢å•å°†è¢«è‡ªåŠ¨å–æ¶ˆ "))],2)):d("",!0)]),a("span",{class:S(["px-3 py-1 rounded-full text-sm",J(s.status)])},i(G(s.status)),3)]),a("div",Et,[a("div",Mt,i(tt(s.roomType)),1),a("div",Dt,[a("div",Rt,[z(s).length>0?(o(),n("span",zt,i(z(s).join("ã€")),1)):(o(),n("span",Ut,"æœªçŸ¥å® ç‰©"))]),a("p",Vt,[s.roomType?(o(),n("span",qt,i(s.roomTypeDisplay||Z(s.roomType)),1)):d("",!0),s.roomType&&s.roomNo?(o(),n("span",At," Â· ")):d("",!0),s.roomNo?(o(),n("span",Ht,i(s.roomNo),1)):d("",!0),!s.roomType&&!s.roomNo?(o(),n("span",Pt,"æˆ¿é—´ä¿¡æ¯ä¸å®Œæ•´")):d("",!0)]),a("p",Ft,[F(i(s.checkInDate)+" è‡³ "+i(s.checkOutDate),1),s.days?(o(),n("span",Wt," ("+i(s.days)+"å¤©)",1)):d("",!0)])]),a("div",Yt,[a("p",Gt,"Â¥"+i(s.totalAmount||s.totalPrice||0),1)])]),s.status===0?(o(),n("div",Jt,[a("button",{onClick:N(m=>at(s),["stop"]),class:"text-primary-600 hover:text-primary-700 font-medium"}," ç«‹å³ä»˜æ¬¾ ",8,Kt),a("button",{onClick:N(m=>U(s),["stop"]),class:"text-red-500 hover:text-red-600"}," å–æ¶ˆè®¢å• ",8,Lt)])):s.status===1?(o(),n("div",Qt,[a("button",{onClick:N(m=>U(s),["stop"]),class:"text-red-500 hover:text-red-600"}," å–æ¶ˆè®¢å• ",8,Xt)])):s.status===3||s.status===4?(o(),n("div",Zt,[a("button",{onClick:N(m=>st(s),["stop"]),class:"text-gray-500 hover:text-gray-700"}," åˆ é™¤è®¢å• ",8,te)])):d("",!0)],8,Nt))),128)),y.value?(o(),n("div",ee,"åŠ è½½ä¸­...")):w.value?d("",!0):(o(),n("div",se,"å·²åŠ è½½å…¨éƒ¨"))])),q(xt,{name:"fade"},{default:P(()=>[D.value?(o(),n("button",{key:0,onClick:nt,class:"fixed bottom-8 right-8 bg-primary-600 text-white rounded-full p-4 shadow-lg hover:bg-primary-700 transition-all z-50",title:"è¿”å›é¡¶éƒ¨"},[...e[4]||(e[4]=[a("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 10l7-7m0 0l7 7m-7-7v18"})],-1)])])):d("",!0)]),_:1}),(o(),pt(yt,{to:"body"},[I.value?(o(),n("div",ae,[a("div",{class:"absolute inset-0 bg-black/50",onClick:T}),a("div",oe,[a("div",{class:"flex items-center justify-between mb-4"},[e[5]||(e[5]=a("h3",{class:"text-lg font-semibold"},"æ”¶é“¶å°",-1)),a("button",{class:"text-gray-400 hover:text-gray-600",onClick:T},"âœ•")]),a("div",ne,"è®¢å•å·ï¼š"+i((u=p.value)==null?void 0:u.orderNo),1),a("div",le,[a("div",ie,[R.value?(o(),n("img",{key:0,src:R.value,class:"w-44 h-44",alt:"æ”¯ä»˜äºŒç»´ç "},null,8,re)):(o(),n("div",ce,"ç”Ÿæˆä¸­..."))]),e[6]||(e[6]=a("div",{class:"text-sm text-gray-600"},"è¯·ä½¿ç”¨æ‰‹æœºæ‰«ç å®Œæˆæ”¯ä»˜",-1)),h.value==="waiting"?(o(),n("div",ue,"ç­‰å¾…æ‰«ç å›è°ƒ...")):(o(),n("div",de,"æ”¯ä»˜æˆåŠŸ"))]),a("div",me,[a("button",{class:"flex-1 px-4 py-2 rounded-lg border border-gray-200 text-gray-600 hover:bg-gray-50",onClick:T,disabled:$.value}," å–æ¶ˆ ",8,ve)])])])):d("",!0)]))])}}});export{fe as default};
