import{d as H,r as u,I as K,s as Q,l as X,c as l,a as e,i as Y,e as g,t as n,n as I,F as y,m as b,h as B,y as Z,D as ee,k as te,G as se,p as v,v as ae,o}from"./index-ClhVCDrs.js";import{b as C,s as M,c as oe}from"./message-CTPluzoh.js";import{f as V}from"./datetime-C5mOaQky.js";const le={class:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},re={key:0,class:"text-center py-20"},ne={key:1,class:"space-y-6"},ie={class:"card"},de={class:"flex justify-between items-center"},ce={class:"text-sm text-gray-500"},ue={class:"text-2xl font-bold mt-1"},ge={class:"card"},me={class:"flex items-center space-x-4"},ve={class:"w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center text-4xl"},xe={class:"font-semibold text-lg"},pe={class:"text-gray-500"},ye={class:"card"},be={class:"grid grid-cols-2 gap-4"},fe={class:"col-span-2"},_e={key:0,class:"flex flex-wrap gap-2"},he={key:1,class:"font-medium text-gray-400"},we={class:"font-medium"},ke={class:"font-medium"},Ce={class:"font-medium"},Te={key:0,class:"mt-4 p-3 bg-gray-50 rounded-lg"},je={class:"text-sm text-gray-600"},Ne={class:"card"},$e={class:"space-y-2"},Ie={class:"flex justify-between"},Re={class:"flex justify-between"},De={key:0,class:"pt-2 border-t"},Se={class:"flex justify-between pt-2 border-t font-bold text-lg"},Ae={class:"text-primary-600"},Be={key:0,class:"card"},Me={key:0,class:"space-y-3"},Ve={class:"flex items-center justify-between"},qe={class:"text-gray-700"},Pe={class:"text-yellow-500"},Oe={class:"ml-2 text-sm text-gray-500"},Ue={class:"text-sm text-gray-500"},ze={key:0,class:"p-3 bg-gray-50 rounded-lg text-gray-700"},Ee={key:1,class:"text-sm text-gray-500"},Fe={key:1,class:"space-y-4"},Le={class:"flex items-center gap-2"},We=["onClick"],Ge={class:"text-sm text-gray-500 ml-2"},Je=["disabled"],He={key:1,class:"card"},Ke={class:"overflow-x-auto pb-2"},Qe={class:"flex gap-4 min-w-full"},Xe={class:"w-72 p-4 bg-gray-50 rounded-xl shadow-sm flex flex-col gap-2"},Ye={class:"flex items-center justify-between"},Ze={class:"text-xs text-gray-500"},et={class:"text-gray-700 leading-relaxed"},tt={key:0,class:"grid grid-cols-2 gap-2"},st=["src"],at={class:"text-xs text-gray-500"},ot={key:0,class:"absolute top-1/2 -right-2 h-px w-4 bg-gray-300"},lt={key:2,class:"flex justify-center space-x-4"},rt=["disabled"],nt={key:0,class:"inline-block animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"},it=["disabled"],dt={key:3,class:"flex justify-center"},ct={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},ut={class:"relative bg-white rounded-2xl shadow-xl w-[360px] p-6"},gt={class:"text-sm text-gray-500"},mt={class:"mt-4 flex flex-col items-center gap-3"},vt={class:"w-48 h-48 rounded-xl border border-gray-200 flex items-center justify-center bg-gray-50"},xt=["src"],pt={key:1,class:"text-gray-400"},yt={key:0,class:"text-xs text-gray-400"},bt={key:1,class:"text-xs text-green-600"},ft={class:"mt-6 flex gap-3"},_t=["disabled"],Tt=H({__name:"detail",setup(ht){const f=ae(),a=u({}),h=u([]),T=u(!0),m=u(!1),j=u(!1),_=u("waiting"),x=u(null),R=K(()=>{var t;if(!((t=a.value)!=null&&t.id))return"";const s=`${window.location.origin}/api/order/${a.value.id}/pay-scan`;return`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(s)}`}),d=u(null),w=u(!1),c=Q({score:5,content:""}),q=s=>({0:"å¾…æ”¯ä»˜",1:"å¾…å…¥ä½",2:"å·²å…¥ä½",3:"å·²å®Œæˆ",4:"å·²å–æ¶ˆ"})[s]||"æœªçŸ¥",P=s=>({0:"bg-yellow-100 text-yellow-800",1:"bg-blue-100 text-blue-800",2:"bg-green-100 text-green-800",3:"bg-gray-100 text-gray-800",4:"bg-red-100 text-red-800"})[s]||"bg-gray-100 text-gray-800",O=s=>({0:"â³",1:"âœ…",2:"ğŸ ",3:"ğŸ‰",4:"âŒ"})[s]||"â“",U=s=>({cat_standard:"çŒ«å’ªæ ‡é—´",cat_deluxe:"çŒ«å’ªè±ªåé—´",dog_standard:"ç‹—ç‹—æ ‡é—´",dog_deluxe:"ç‹—ç‹—è±ªåé—´",vip_suite:"VIPå¥—é—´"})[s]||s,z=s=>s!=null&&s.startsWith("cat")?"ğŸ±":s!=null&&s.startsWith("dog")?"ğŸ•":"ğŸ‘‘",E=s=>{const t={1:"å–‚é£Ÿ",2:"é›å¼¯",3:"æ¸…æ´",4:"ä½“æ£€",5:"å…¶ä»–",6:"å…¥ä½ç™»è®°"},i={feeding:"å–‚é£Ÿ",walking:"é›å¼¯",cleaning:"æ¸…æ´",health_check:"ä½“æ£€",other:"å…¶ä»–",check_in:"å…¥ä½ç™»è®°",checkin:"å…¥ä½ç™»è®°"};return typeof s=="number"?t[s]||String(s):i[s]||String(s??"")},F=s=>{const t={1:"bg-green-100 text-green-600",2:"bg-yellow-100 text-yellow-600",3:"bg-blue-100 text-blue-600",4:"bg-red-100 text-red-600",5:"bg-gray-100 text-gray-600",6:"bg-indigo-100 text-indigo-600"},i={feeding:"bg-green-100 text-green-600",walking:"bg-yellow-100 text-yellow-600",cleaning:"bg-blue-100 text-blue-600",health_check:"bg-red-100 text-red-600",other:"bg-gray-100 text-gray-600",check_in:"bg-indigo-100 text-indigo-600",checkin:"bg-indigo-100 text-indigo-600"};return typeof s=="number"?t[s]||"bg-gray-100 text-gray-600":i[s]||"bg-gray-100 text-gray-600"},D=s=>!s||!s.images?[]:Array.isArray(s.images)?s.images.filter(Boolean):s.images.split(",").map(t=>t.trim()).filter(Boolean),L=s=>({1:"ğŸ±",2:"ğŸ•",3:"ğŸ°"})[s]||"ğŸ¾",S=s=>{if(s.pets&&s.pets.length>0)return s.pets;if(s.petName)return[{id:0,name:s.petName,type:0}];if(s.petIds)try{return(typeof s.petIds=="string"?JSON.parse(s.petIds):s.petIds).map((i,r)=>({id:typeof i=="number"?i:r,name:`å® ç‰©${r+1}`,type:0}))}catch{return[]}return[]},W=async()=>{T.value=!0;try{const s=await v.get(`/order/${f.params.id}`);if(a.value=s.data,s.data.status===2){const i=(await v.get(`/care-log/order/${f.params.id}`)).data||[];h.value=i.sort((r,p)=>{const N=new Date(r.createdAt).getTime(),$=new Date(p.createdAt).getTime();return N-$})}if(s.data.status===3){const t=await v.get(`/hotel-review/order/${f.params.id}`);d.value=t.data||null}else d.value=null}catch(s){console.error("è·å–è®¢å•è¯¦æƒ…å¤±è´¥:",s)}finally{T.value=!1}},G=async()=>{var s;if(a.value){if(c.score<1||c.score>5){C("è¯·å…ˆé€‰æ‹©è¯„åˆ†");return}w.value=!0;try{await v.post("/hotel-review",{orderId:a.value.id,score:c.score,content:((s=c.content)==null?void 0:s.trim())||void 0}),M("è¯„ä»·æäº¤æˆåŠŸ");const t=await v.get(`/hotel-review/order/${a.value.id}`);d.value=t.data||null}catch(t){C(t.message||"æäº¤å¤±è´¥")}finally{w.value=!1}}},A=async()=>{if(await oe("ç¡®å®šè¦å–æ¶ˆè¯¥è®¢å•å—ï¼Ÿ"))try{await v.post(`/order/${f.params.id}/cancel`),a.value&&(a.value.status=4)}catch(s){C(s.message||"å–æ¶ˆå¤±è´¥")}},J=()=>{m.value=!1,_.value="waiting",j.value=!0,x.value&&window.clearTimeout(x.value),x.value=window.setTimeout(async()=>{if(a.value)try{await v.get(`/order/${f.params.id}/pay-scan`),a.value.status=1,_.value="success",M("æ”¯ä»˜æˆåŠŸï¼è¯·åœ¨å…¥ä½å½“å¤©12:00ååŠç†å…¥ä½æ‰‹ç»­"),k()}catch(s){C(s.message||"æ”¯ä»˜å¤±è´¥"),_.value="waiting"}},1e4)},k=()=>{x.value&&window.clearTimeout(x.value),x.value=null,m.value=!1,j.value=!1,_.value="waiting"};return X(W),(s,t)=>{var i;return o(),l("div",le,[e("button",{onClick:t[0]||(t[0]=r=>s.$router.back()),class:"flex items-center text-gray-600 hover:text-primary-600 mb-6"},[...t[2]||(t[2]=[e("span",null,"â† è¿”å›è®¢å•åˆ—è¡¨",-1)])]),T.value?(o(),l("div",re,[...t[3]||(t[3]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-4 border-primary-600 border-t-transparent"},null,-1)])])):(o(),l("div",ne,[e("div",ie,[e("div",de,[e("div",null,[e("p",ce,"è®¢å•å·: "+n(a.value.orderNo),1),e("h2",ue,n(q(a.value.status)),1)]),e("span",{class:I(["px-4 py-2 rounded-full text-lg",P(a.value.status)])},n(O(a.value.status)),3)])]),e("div",ge,[t[4]||(t[4]=e("h3",{class:"text-lg font-semibold mb-4"},"æˆ¿é—´ä¿¡æ¯",-1)),e("div",me,[e("div",ve,n(z(a.value.roomType)),1),e("div",null,[e("p",xe,n(a.value.roomTypeDisplay||U(a.value.roomType)),1),e("p",pe,"æˆ¿é—´å·: "+n(a.value.roomNo),1)])])]),e("div",ye,[t[9]||(t[9]=e("h3",{class:"text-lg font-semibold mb-4"},"å…¥ä½ä¿¡æ¯",-1)),e("div",be,[e("div",fe,[t[5]||(t[5]=e("p",{class:"text-gray-500 text-sm mb-2"},"å…¥ä½å® ç‰©",-1)),S(a.value).length>0?(o(),l("div",_e,[(o(!0),l(y,null,b(S(a.value),r=>(o(),l("span",{key:r.id||r.name,class:"px-3 py-1 bg-primary-50 text-primary-700 rounded-full text-sm font-medium"},n(L(r.type))+" "+n(r.name),1))),128))])):(o(),l("p",he,"æœªçŸ¥å® ç‰©"))]),e("div",null,[t[6]||(t[6]=e("p",{class:"text-gray-500 text-sm"},"å…¥ä½æ—¥æœŸ",-1)),e("p",we,n(a.value.checkInDate),1)]),e("div",null,[t[7]||(t[7]=e("p",{class:"text-gray-500 text-sm"},"é€€æˆ¿æ—¥æœŸ",-1)),e("p",ke,n(a.value.checkOutDate),1)]),e("div",null,[t[8]||(t[8]=e("p",{class:"text-gray-500 text-sm"},"å…¥ä½å¤©æ•°",-1)),e("p",Ce,n(a.value.days)+"å¤©",1)])]),a.value.remark?(o(),l("div",Te,[e("p",je,"å¤‡æ³¨: "+n(a.value.remark),1)])):g("",!0)]),e("div",Ne,[t[14]||(t[14]=e("h3",{class:"text-lg font-semibold mb-4"},"è´¹ç”¨ä¿¡æ¯",-1)),e("div",$e,[e("div",Ie,[t[10]||(t[10]=e("span",{class:"text-gray-500"},"æˆ¿é—´å•ä»·",-1)),e("span",null,"Â¥"+n(a.value.roomPrice)+"/å¤©",1)]),e("div",Re,[t[11]||(t[11]=e("span",{class:"text-gray-500"},"å…¥ä½å¤©æ•°",-1)),e("span",null,n(a.value.days)+"å¤©",1)]),a.value.items&&a.value.items.length?(o(),l("div",De,[t[12]||(t[12]=e("div",{class:"text-gray-500 mb-2"},"å•†å“æ˜ç»†",-1)),(o(!0),l(y,null,b(a.value.items,(r,p)=>(o(),l("div",{key:p,class:"flex justify-between text-sm"},[e("span",null,n(r.productName)+" x"+n(r.quantity),1),e("span",null,"Â¥"+n(r.subtotal),1)]))),128))])):g("",!0),e("div",Se,[t[13]||(t[13]=e("span",null,"è®¢å•æ€»ä»·",-1)),e("span",Ae,"Â¥"+n(a.value.totalAmount||a.value.totalPrice),1)])])]),a.value.status===3?(o(),l("div",Be,[t[18]||(t[18]=e("h3",{class:"text-lg font-semibold mb-4"},"é…’åº—è¯„ä»·",-1)),d.value?(o(),l("div",Me,[e("div",Ve,[e("div",qe,[t[15]||(t[15]=e("span",{class:"font-medium"},"è¯„åˆ†ï¼š",-1)),e("span",Pe,[(o(),l(y,null,b(5,r=>e("span",{key:r},n(r<=d.value.score?"â˜…":"â˜†"),1)),64))]),e("span",Oe,"("+n(d.value.score)+"/5)",1)]),e("div",Ue,n(B(V)(d.value.createdAt)),1)]),d.value.content?(o(),l("div",ze,n(d.value.content),1)):(o(),l("div",Ee,"æœªå¡«å†™æ–‡å­—è¯„ä»·"))])):(o(),l("div",Fe,[e("div",null,[t[16]||(t[16]=e("p",{class:"text-sm text-gray-600 mb-2"},"æ»¡æ„åº¦ï¼ˆ5åˆ†ä¸ºæ»¡åˆ†ï¼‰",-1)),e("div",Le,[(o(),l(y,null,b(5,r=>e("button",{key:r,type:"button",class:I(["text-2xl",r<=c.score?"text-yellow-500":"text-gray-300"]),onClick:p=>c.score=r,"aria-label":"score"}," â˜… ",10,We)),64)),e("span",Ge,n(c.score)+"/5",1)])]),e("div",null,[t[17]||(t[17]=e("p",{class:"text-sm text-gray-600 mb-2"},"è¯„ä»·å†…å®¹ï¼ˆå¯é€‰ï¼‰",-1)),Z(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=r=>c.content=r),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 outline-none transition-all duration-200",rows:"3",placeholder:"è¯´è¯´ä½ çš„å…¥ä½ä½“éªŒå§"},null,512),[[ee,c.content]])]),e("div",null,[e("button",{type:"button",class:"btn-primary",disabled:w.value,onClick:G},n(w.value?"æäº¤ä¸­...":"æäº¤è¯„ä»·"),9,Je)])]))])):g("",!0),a.value.status===2&&h.value.length>0?(o(),l("div",He,[t[19]||(t[19]=e("h3",{class:"text-lg font-semibold mb-4"},"ç…§æ–™è®°å½•",-1)),e("div",Ke,[e("div",Qe,[(o(!0),l(y,null,b(h.value,(r,p)=>(o(),l("div",{key:r.id,class:"relative"},[e("div",Xe,[e("div",Ye,[e("span",{class:I(["px-2 py-1 rounded text-sm",F(r.careType)])},n(E(r.careType)),3),e("span",Ze,n(B(V)(r.createdAt)),1)]),e("p",et,n(r.content),1),D(r).length?(o(),l("div",tt,[(o(!0),l(y,null,b(D(r),(N,$)=>(o(),l("img",{key:$,src:N,class:"w-full h-24 object-cover rounded-lg border border-gray-200",alt:"æŠ¤ç†å›¾ç‰‡"},null,8,st))),128))])):g("",!0),e("p",at,"è®°å½•äºº: "+n(r.staffName),1)]),p<h.value.length-1?(o(),l("div",ot)):g("",!0)]))),128))])])])):g("",!0),a.value.status===0?(o(),l("div",lt,[e("button",{onClick:J,disabled:m.value,class:"px-8 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center min-w-[120px]"},[m.value?(o(),l("span",nt)):g("",!0),te(" "+n(m.value?"ä»˜æ¬¾ä¸­...":"ç«‹å³ä»˜æ¬¾"),1)],8,rt),e("button",{onClick:A,disabled:m.value,class:"px-8 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors disabled:opacity-50"}," å–æ¶ˆè®¢å• ",8,it)])):a.value.status===1?(o(),l("div",dt,[e("button",{onClick:A,class:"px-8 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors"}," å–æ¶ˆè®¢å• ")])):g("",!0)])),(o(),Y(se,{to:"body"},[j.value?(o(),l("div",ct,[e("div",{class:"absolute inset-0 bg-black/50",onClick:k}),e("div",ut,[e("div",{class:"flex items-center justify-between mb-4"},[t[20]||(t[20]=e("h3",{class:"text-lg font-semibold"},"æ”¶é“¶å°",-1)),e("button",{class:"text-gray-400 hover:text-gray-600",onClick:k},"âœ•")]),e("div",gt,"è®¢å•å·ï¼š"+n((i=a.value)==null?void 0:i.orderNo),1),e("div",mt,[e("div",vt,[R.value?(o(),l("img",{key:0,src:R.value,class:"w-44 h-44",alt:"æ”¯ä»˜äºŒç»´ç "},null,8,xt)):(o(),l("div",pt,"ç”Ÿæˆä¸­..."))]),t[21]||(t[21]=e("div",{class:"text-sm text-gray-600"}," è¯·ä½¿ç”¨æ‰‹æœºæ‰«ç å®Œæˆæ”¯ä»˜ ",-1)),_.value==="waiting"?(o(),l("div",yt,"ç­‰å¾…æ‰«ç å›è°ƒ...")):(o(),l("div",bt,"æ”¯ä»˜æˆåŠŸ"))]),e("div",ft,[e("button",{class:"flex-1 px-4 py-2 rounded-lg border border-gray-200 text-gray-600 hover:bg-gray-50",onClick:k,disabled:m.value}," å–æ¶ˆ ",8,_t)])])])):g("",!0)]))])}}});export{Tt as default};
