import{d as P,r as i,s as Y,l as G,v as J,x as K,c as a,a as o,e as v,f as Q,y as N,z as C,F as S,m as I,b as H,t as n,w as W,T as X,p as Z,k as ee,A as te,o as l,_ as oe}from"./index-ClhVCDrs.js";import{a as se,b as ae}from"./index-C1oTlUQQ.js";const le={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},ne={class:"card mb-8"},re={class:"flex flex-wrap gap-4 items-end"},ie={class:"w-48"},de=["value"],ue={class:"w-48"},ce={class:"w-48"},pe={key:0,class:"text-center py-20"},ve={key:1,class:"text-center py-20"},me={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},ge=["onClick"],ye={class:"h-48 bg-gray-200 rounded-lg mb-4 overflow-hidden relative"},he={key:0,class:"w-full h-full"},xe=["src","alt"],fe={key:0,class:"absolute bottom-2 right-2 bg-black bg-opacity-60 text-white text-xs px-2 py-1 rounded"},be={key:1,class:"w-full h-full flex items-center justify-center text-6xl"},we={class:"flex justify-between items-start mb-2"},_e={class:"text-xl font-semibold"},ke={class:"text-gray-500 text-sm mb-2"},Ne={key:0,class:"text-gray-500 text-sm mb-2"},Ce={class:"flex flex-col gap-1 text-sm text-gray-700 mb-2"},Se={class:"flex items-center gap-2"},Ie={class:"text-yellow-500"},Te={class:"text-gray-500"},Ae={class:"text-gray-400 text-xs"},Be={class:"flex items-center gap-2"},Me={class:"text-yellow-500"},Re={class:"text-gray-500"},Ve={class:"text-gray-400 text-xs"},He={key:1,class:"flex flex-wrap gap-1 mb-2"},$e={class:"text-gray-600 mb-4 line-clamp-2"},je={class:"flex justify-between items-center"},Ee={class:"text-2xl font-bold text-primary-600"},Fe=["onClick"],Le={key:3,class:"text-center py-8"},ze={key:4,class:"text-center py-8 text-gray-500"},De=P({__name:"index",setup(Ue){const T=J(),d=i([]),A=i([]),m=i(!1),g=i(!1),f=i(1),$=i(12),y=i(0),h=i(!0),B=i(!1),b=i({}),w=new Set,r=Y({hotelId:"",roomType:"",orderBy:""}),M=()=>{B.value=window.scrollY>300;const s=window.scrollY,e=window.innerHeight,t=document.documentElement.scrollHeight;s+e>=t-200&&!m.value&&!g.value&&h.value&&z()},j=()=>{window.scrollTo({top:0,behavior:"smooth"})};G(()=>{T.query.hotelId&&(r.hotelId=T.query.hotelId),E(),_(!0),window.addEventListener("scroll",M)}),K(()=>{window.removeEventListener("scroll",M)});const E=async()=>{try{const s=await se();A.value=s.data}catch(s){console.error("è·å–é…’åº—åˆ—è¡¨å¤±è´¥:",s)}},F=s=>{const e=s.toLowerCase();return e.includes("çŒ«")||e.includes("cat")?"ğŸ±":e.includes("ç‹—")||e.includes("dog")||e.includes("çŠ¬")?"ğŸ•":"ğŸ "},R=s=>{if(!s)return[];try{return JSON.parse(s)}catch{return[]}},x=s=>{if(!s)return[];try{return JSON.parse(s)}catch{return[]}},V=s=>{if(!s||s<=0)return"â˜†â˜†â˜†â˜†â˜†";const e=Math.min(5,Math.max(0,Math.round(s)));return"â˜…â˜…â˜…â˜…â˜…".slice(0,e)+"â˜†â˜†â˜†â˜†â˜†".slice(0,5-e)},u=s=>b.value[s]||{roomAvg:0,roomCount:0,hotelAvg:0,hotelCount:0},L=async s=>{const e=Array.from(new Set(s.map(t=>t.hotelId).filter(Boolean)));for(const t of e)if(!w.has(Number(t)))try{const p=(await Z.get(`/hotel-review/summary/${t}`)).data||{},U=Number(p.hotelAvgScore||0),q=Number(p.hotelReviewCount||0);Array.isArray(p.rooms)&&p.rooms.forEach(k=>{const O=Number(k.roomId);b.value[O]={roomAvg:Number(k.avgScore||0),roomCount:Number(k.reviewCount||0),hotelAvg:U,hotelCount:q}}),w.add(Number(t))}catch(c){console.error("è·å–é…’åº—è¯„åˆ†æ±‡æ€»å¤±è´¥:",c)}},_=async(s=!1)=>{s?(m.value=!0,f.value=1,d.value=[],b.value={},w.clear(),h.value=!0):g.value=!0;try{const e={pageNum:f.value,pageSize:$.value};r.hotelId&&(e.hotelId=Number(r.hotelId)),r.roomType&&(e.roomType=r.roomType),r.orderBy&&(e.orderBy=r.orderBy,e.orderDirection="desc");const t=await ae(e);s?d.value=t.data.records:d.value=[...d.value,...t.data.records],y.value=t.data.total,h.value=d.value.length<y.value,await L(t.data.records)}catch(e){console.error("è·å–æˆ¿é—´å¤±è´¥:",e)}finally{m.value=!1,g.value=!1}},z=()=>{h.value&&(f.value++,_(!1))},D=()=>{_(!0)};return(s,e)=>(l(),a("div",le,[e[16]||(e[16]=o("h1",{class:"text-3xl font-bold text-gray-900 mb-8"},"é€‰æ‹©æˆ¿é—´",-1)),o("div",ne,[o("div",re,[o("div",ie,[e[4]||(e[4]=o("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"é—¨åº—",-1)),N(o("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>r.hotelId=t),class:"input-field"},[e[3]||(e[3]=o("option",{value:""},"å…¨éƒ¨é—¨åº—",-1)),(l(!0),a(S,null,I(A.value,t=>(l(),a("option",{key:t.id,value:t.id},n(t.name),9,de))),128))],512),[[C,r.hotelId]])]),o("div",ue,[e[6]||(e[6]=o("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"æˆ¿é—´ç±»å‹",-1)),N(o("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>r.roomType=t),class:"input-field"},[...e[5]||(e[5]=[H('<option value="" data-v-b3a17675>å…¨éƒ¨ç±»å‹</option><option value="cat_standard" data-v-b3a17675>çŒ«å’ªæ ‡é—´</option><option value="cat_deluxe" data-v-b3a17675>çŒ«å’ªè±ªåé—´</option><option value="dog_standard" data-v-b3a17675>ç‹—ç‹—æ ‡é—´</option><option value="dog_deluxe" data-v-b3a17675>ç‹—ç‹—è±ªåé—´</option><option value="vip_suite" data-v-b3a17675>VIPå¥—é—´</option>',6)])],512),[[C,r.roomType]])]),o("div",ce,[e[8]||(e[8]=o("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"æ’åºæ–¹å¼",-1)),N(o("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>r.orderBy=t),class:"input-field"},[...e[7]||(e[7]=[H('<option value="" data-v-b3a17675>é»˜è®¤æ’åº</option><option value="roomScore" data-v-b3a17675>æˆ¿é—´è¯„åˆ†</option><option value="roomCount" data-v-b3a17675>æˆ¿é—´è¯„ä»·æ•°</option><option value="hotelScore" data-v-b3a17675>é…’åº—è¯„åˆ†</option><option value="hotelCount" data-v-b3a17675>é…’åº—è¯„ä»·æ•°</option>',5)])],512),[[C,r.orderBy]])]),o("div",{class:"ml-auto"},[o("button",{onClick:D,class:"px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors whitespace-nowrap"}," ç­›é€‰ ")])])]),m.value?(l(),a("div",pe,[...e[9]||(e[9]=[o("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-4 border-primary-600 border-t-transparent"},null,-1),o("p",{class:"mt-4 text-gray-600"},"åŠ è½½ä¸­...",-1)])])):d.value.length===0?(l(),a("div",ve,[...e[10]||(e[10]=[o("span",{class:"text-6xl"},"ğŸ ",-1),o("p",{class:"mt-4 text-gray-600"},"æš‚æ— å¯ç”¨æˆ¿é—´",-1)])])):(l(),a("div",me,[(l(!0),a(S,null,I(d.value,t=>(l(),a("div",{key:t.id,class:"card hover:shadow-lg transition-shadow cursor-pointer",onClick:c=>s.$router.push(`/rooms/${t.id}`)},[o("div",ye,[x(t.images).length>0?(l(),a("div",he,[o("img",{src:x(t.images)[0],alt:t.typeName,class:"w-full h-full object-cover"},null,8,xe),x(t.images).length>1?(l(),a("div",fe," å…±"+n(x(t.images).length)+"å¼  ",1)):v("",!0)])):(l(),a("div",be,n(F(t.typeName)),1))]),o("div",we,[o("h3",_e,n(t.typeNameDisplay||t.typeName),1)]),o("p",ke,"æˆ¿é—´å·: "+n(t.roomNo),1),t.hotelName?(l(),a("p",Ne,"é—¨åº—: "+n(t.hotelName),1)):v("",!0),o("div",Ce,[o("div",Se,[e[11]||(e[11]=o("span",{class:"font-medium"},"æˆ¿é—´è¯„åˆ†:",-1)),o("span",Ie,n(V(u(t.id).roomAvg)),1),o("span",Te,n(u(t.id).roomAvg.toFixed(1))+"/5",1),o("span",Ae,"("+n(u(t.id).roomCount)+" äºº)",1)]),o("div",Be,[e[12]||(e[12]=o("span",{class:"font-medium"},"é…’åº—è¯„åˆ†:",-1)),o("span",Me,n(V(u(t.id).hotelAvg)),1),o("span",Re,n(u(t.id).hotelAvg.toFixed(1))+"/5",1),o("span",Ve,"("+n(u(t.id).hotelCount)+" äºº)",1)])]),R(t.features).length>0?(l(),a("div",He,[(l(!0),a(S,null,I(R(t.features),(c,p)=>(l(),a("span",{key:p,class:"px-2 py-1 text-xs bg-blue-50 text-blue-600 rounded"},n(c),1))),128))])):v("",!0),o("p",$e,n(t.description||"èˆ’é€‚æ¸©é¦¨çš„å® ç‰©æˆ¿é—´"),1),o("div",je,[o("span",Ee,[ee(" Â¥"+n(t.pricePerNight)+" ",1),e[13]||(e[13]=o("span",{class:"text-sm text-gray-500"},"/å¤©",-1))]),o("button",{onClick:te(c=>s.$router.push(`/rooms/${t.id}`),["stop"]),class:"btn-primary"}," æŸ¥çœ‹è¯¦æƒ… ",8,Fe)])],8,ge))),128))])),g.value?(l(),a("div",Le,[...e[14]||(e[14]=[o("div",{class:"inline-block animate-spin rounded-full h-6 w-6 border-4 border-primary-600 border-t-transparent"},null,-1),o("p",{class:"mt-2 text-gray-600"},"åŠ è½½ä¸­...",-1)])])):v("",!0),!m.value&&!g.value&&d.value.length>=y.value&&y.value>0?(l(),a("div",ze,[o("p",null,"å·²ç»åˆ°åº•äº†ï¼Œå…± "+n(y.value)+" é—´æˆ¿é—´",1)])):v("",!0),Q(X,{name:"fade"},{default:W(()=>[B.value?(l(),a("button",{key:0,onClick:j,class:"fixed bottom-8 right-8 bg-primary-600 text-white rounded-full p-4 shadow-lg hover:bg-primary-700 transition-all z-50",title:"è¿”å›é¡¶éƒ¨"},[...e[15]||(e[15]=[o("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 10l7-7m0 0l7 7m-7-7v18"})],-1)])])):v("",!0)]),_:1})]))}}),Pe=oe(De,[["__scopeId","data-v-b3a17675"]]);export{Pe as default};
